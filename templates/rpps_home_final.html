<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Credenciamento - Painel RPPS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* ANIMAÇÃO TECH DE PARTÍCULAS */
        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .navbar-modern, .main-container, .modal-overlay {
            position: relative;
            z-index: 1;
        }

        /* NAVBAR */
        .navbar-modern {
            background: linear-gradient(135deg, #0a1628 0%, #0c2340 100%);
            border-bottom: none;
            padding: 0 48px;
            height: 64px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .navbar-modern::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #1e3a5f, #3b82f6, #1e3a5f, transparent);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .brand-logo img {
            height: 80px;
            object-fit: contain;
            margin-right: 16px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .brand-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.025em;
        }

        .brand-subtitle {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 8px 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: linear-gradient(135deg, #2c5282 0%, #4a8bc2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .user-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
        }

        .user-role {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        /* CONTAINER */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 48px;
        }

        /* ========================================
           HERO WELCOME SECTION - PREMIUM
           ======================================== */
        .hero-welcome {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.6) 0%, rgba(30, 58, 95, 0.4) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            padding: 24px 32px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .hero-welcome::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.5), transparent);
        }

        .hero-welcome::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .hero-content {
            z-index: 1;
        }

        .welcome-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #34d399;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
        }

        .hero-title {
            font-size: 2rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }

        .gradient-text {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 50%, #f472b6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-name {
            color: #ffffff;
            font-weight: 700;
        }

        .hero-subtitle {
            font-size: 0.95rem;
            color: #94a3b8;
            font-weight: 400;
        }

        .hero-stats-mini {
            display: flex;
            align-items: center;
            gap: 24px;
            z-index: 1;
        }

        .mini-stat {
            text-align: center;
        }

        .mini-stat-value {
            display: block;
            font-size: 1.75rem;
            font-weight: 700;
            color: #f1f5f9;
            line-height: 1;
            margin-bottom: 4px;
        }

        .mini-stat.success .mini-stat-value {
            color: #34d399;
        }

        .mini-stat-label {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .mini-stat-divider {
            width: 1px;
            height: 40px;
            background: linear-gradient(180deg, transparent, rgba(148, 163, 184, 0.3), transparent);
        }

        /* ========================================
           STATS CARDS - PREMIUM GLASSMORPHISM
           ======================================== */
        .stats-grid-premium {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 48px;
        }

        .stat-card-premium {
            position: relative;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 20px;
            padding: 24px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .stat-card-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        }

        .stat-card-premium:hover {
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .stat-card-glow {
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 60%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .stat-card-premium:hover .stat-card-glow {
            opacity: 1;
        }

        .stat-card-content {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .stat-icon-wrapper {
            position: relative;
        }

        .stat-icon-bg {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #60a5fa;
            transition: all 0.3s ease;
        }

        .stat-icon-wrapper.warning .stat-icon-bg {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(245, 158, 11, 0.1) 100%);
            border-color: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        .stat-icon-wrapper.success .stat-icon-bg {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.1) 100%);
            border-color: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        .stat-icon-wrapper.danger .stat-icon-bg {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%);
            border-color: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .stat-pulse {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 48px;
            height: 48px;
            border-radius: 16px;
            transform: translate(-50%, -50%);
            animation: stat-pulse 2s infinite;
        }

        .stat-pulse.warning {
            background: rgba(245, 158, 11, 0.3);
        }

        @keyframes stat-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.3); opacity: 0; }
        }

        .stat-info {
            flex: 1;
        }

        .stat-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .stat-value-row {
            display: flex;
            align-items: baseline;
            gap: 12px;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #f1f5f9;
            line-height: 1;
        }

        .stat-value.warning { color: #fbbf24; }
        .stat-value.success { color: #34d399; }
        .stat-value.danger { color: #f87171; }

        .stat-trend {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            color: #60a5fa;
        }

        .stat-trend.warning { color: #fbbf24; }
        .stat-trend.success { color: #34d399; }
        .stat-trend.danger { color: #f87171; }

        .stat-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(148, 163, 184, 0.1);
        }

        .stat-progress-bar {
            height: 100%;
            border-radius: 0 3px 3px 0;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ========================================
           SECTION HEADER
           ======================================== */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title-wrapper {
            flex: 1;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 2px;
        }

        .section-subtitle {
            font-size: 0.8rem;
            color: #64748b;
        }

        .section-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .view-toggle {
            display: flex;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            padding: 4px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .view-btn {
            padding: 8px 12px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .view-btn:hover {
            color: #94a3b8;
        }

        .view-btn.active {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        /* ========================================
           CATEGORY CARDS - PREMIUM 3D
           ======================================== */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .category-card {
            position: relative;
            border-radius: 20px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            border: 1px solid rgba(148, 163, 184, 0.15);
            /* Efeito 3D com múltiplas sombras */
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.3),
                0 10px 20px rgba(0, 0, 0, 0.25),
                0 1px 0 rgba(255, 255, 255, 0.05) inset,
                0 -2px 10px rgba(0, 0, 0, 0.2) inset;
            transform: perspective(1000px) rotateX(2deg);
            transform-style: preserve-3d;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            z-index: 2;
        }

        .category-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 10%;
            right: 10%;
            height: 20px;
            background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.4) 0%, transparent 70%);
            transform: translateY(100%);
            filter: blur(8px);
            z-index: -1;
            transition: all 0.4s ease;
        }

        .category-card-bg {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.95) 100%);
            z-index: 0;
            transition: all 0.4s ease;
        }

        .category-card.gestor .category-card-bg {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(15, 23, 42, 0.95) 100%);
        }

        .category-card.distribuidor .category-card-bg {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(15, 23, 42, 0.95) 100%);
        }

        .category-card.administrador .category-card-bg {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(15, 23, 42, 0.95) 100%);
        }

        .category-card:hover {
            transform: perspective(1000px) rotateX(0deg) translateY(-12px) scale(1.02);
            border-color: rgba(59, 130, 246, 0.4);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 30px 60px rgba(0, 0, 0, 0.3),
                0 0 80px rgba(59, 130, 246, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
        }

        .category-card:hover::after {
            opacity: 0.8;
            transform: translateY(120%);
        }

        .category-card.gestor:hover { 
            border-color: rgba(59, 130, 246, 0.5); 
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 30px 60px rgba(0, 0, 0, 0.3),
                0 0 80px rgba(59, 130, 246, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
        }
        .category-card.distribuidor:hover { 
            border-color: rgba(139, 92, 246, 0.5); 
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 30px 60px rgba(0, 0, 0, 0.3),
                0 0 80px rgba(139, 92, 246, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
        }
        .category-card.administrador:hover { 
            border-color: rgba(16, 185, 129, 0.5); 
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 30px 60px rgba(0, 0, 0, 0.3),
                0 0 80px rgba(16, 185, 129, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
        }

        .category-card.active {
            transform: perspective(1000px) rotateX(0deg) translateY(-8px) scale(1.01);
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.4),
                0 25px 50px rgba(0, 0, 0, 0.3),
                0 0 60px rgba(59, 130, 246, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
        }

        .category-content {
            position: relative;
            z-index: 1;
        }

        .category-icon-wrapper {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }

        .category-icon {
            width: 72px;
            height: 72px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            transition: all 0.3s ease;
        }

        .category-card.gestor .category-icon { color: #60a5fa; }
        .category-card.distribuidor .category-icon { 
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-color: rgba(139, 92, 246, 0.2);
            color: #a78bfa; 
        }
        .category-card.administrador .category-icon { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.1) 100%);
            border-color: rgba(16, 185, 129, 0.2);
            color: #34d399; 
        }

        .category-card:hover .category-icon {
            transform: scale(1.05);
        }

        .category-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            min-width: 28px;
            height: 28px;
            padding: 0 8px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .category-info {
            margin-bottom: 24px;
        }

        .category-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 8px;
        }

        .category-description {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.5;
        }

        .category-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 1px solid rgba(148, 163, 184, 0.1);
        }

        .category-stats {
            display: flex;
            gap: 16px;
        }

        .category-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8125rem;
            color: #94a3b8;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .dot.pending {
            background: #fbbf24;
            box-shadow: 0 0 8px rgba(251, 191, 36, 0.5);
        }

        .category-arrow {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #60a5fa;
            transition: all 0.3s ease;
        }

        .category-card:hover .category-arrow {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(4px);
        }

        .category-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .category-card:hover .category-shine {
            left: 100%;
        }

        /* Legacy styles for compatibility */
        .page-header {
            margin-bottom: 20px;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 6px;
        }

        .page-subtitle {
            font-size: 0.875rem;
            color: #94a3b8;
            font-weight: 400;
        }

        /* PASTAS */
        .folders-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 32px;
            margin-bottom: 24px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .folder-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 2px solid #e4e4e7;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .folder-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(135deg, #2c5282 0%, #3a6ea5 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .folder-card:hover {
            border-color: #2c5282;
            box-shadow: 0 8px 24px rgba(44, 82, 130, 0.15);
            transform: translateY(-4px);
        }

        .folder-card:hover::before {
            transform: scaleX(1);
        }

        .folder-card.active {
            border-color: #2c5282;
            background: linear-gradient(135deg, #f0f4f8 0%, #ffffff 100%);
            box-shadow: 0 8px 24px rgba(44, 82, 130, 0.2);
        }

        .folder-card.active::before {
            transform: scaleX(1);
        }

        .folder-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            border: 2px solid #bfdbfe;
        }

        .folder-title {
            font-size: 1rem;
            font-weight: 700;
            color: #18181b;
            margin-bottom: 4px;
        }

        .folder-count {
            font-size: 0.75rem;
            color: #52525b;
            font-weight: 500;
        }

        .folder-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 28px;
            height: 28px;
            padding: 0 10px;
            background: linear-gradient(135deg, #2c5282 0%, #3a6ea5 100%);
            color: white;
            border-radius: 14px;
            font-size: 0.8125rem;
            font-weight: 700;
            margin-top: 12px;
            box-shadow: 0 2px 8px rgba(44, 82, 130, 0.3);
        }

        /* CARDS */
        .grid {
            display: grid;
            gap: 24px;
        }

        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .card-modern {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e4e4e7;
            transition: all 0.3s ease;
        }

        .card-modern:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .mb-4 {
            margin-bottom: 20px;
        }

        /* BOTÕES */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            text-decoration: none;
            line-height: 1;
            letter-spacing: 0.025em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0c2340 0%, #2c5282 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(12, 35, 64, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #020617 0%, #0c2340 100%);
            box-shadow: 0 4px 12px rgba(12, 35, 64, 0.3);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(30, 41, 59, 0.8);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .btn-secondary:hover {
            background: rgba(30, 41, 59, 1);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.8125rem;
        }

        /* TABELA */
        .table-container {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-modern {
            width: 100%;
            border-collapse: collapse;
        }

        .table-modern thead {
            background: rgba(15, 23, 42, 0.6);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .table-modern th {
            padding: 16px 24px;
            text-align: left;
            font-weight: 700;
            font-size: 0.8125rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .table-modern td {
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9375rem;
        }

        .table-modern tbody tr {
            transition: background 0.15s ease;
        }

        .table-modern tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* BADGES */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.025em;
            line-height: 1;
        }

        /* Botões de Filtro - Estilo Escuro */
        .filter-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: rgba(15, 23, 42, 0.6);
            color: rgba(255, 255, 255, 0.7);
        }

        .filter-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
            color: #fff;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #3b82f6;
            color: #fff;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        /* Campo de Busca Escuro */
        .search-input-dark {
            background: rgba(15, 23, 42, 0.6) !important;
            border: 1px solid rgba(255, 255, 255, 0.15) !important;
            color: #fff !important;
            border-radius: 8px;
            padding: 10px 16px;
        }

        .search-input-dark::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .search-input-dark:focus {
            border-color: rgba(59, 130, 246, 0.5) !important;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .badge-status {
            padding: 8px 14px;
            border-radius: 8px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-draft {
            background: rgba(113, 113, 122, 0.2);
            color: #a1a1aa;
            border: 1px solid rgba(113, 113, 122, 0.3);
        }

        .badge-submitted {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .badge-in_review,
        .badge-in-review {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .badge-returned {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .badge-approved {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .badge-rejected {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* FORMULÁRIOS */
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            font-size: 0.9375rem;
            color: #ffffff;
            background: rgba(15, 23, 42, 0.6);
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .form-input:focus {
            outline: none;
            border-color: #2c5282;
            box-shadow: 0 0 0 3px rgba(44, 82, 130, 0.1);
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 32px;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }

        .modal-header {
            padding: 28px 32px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3) 0%, rgba(59, 130, 246, 0.1) 100%);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            background: linear-gradient(135deg, #ffffff 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-body {
            padding: 32px;
            color: #ffffff;
        }

        .modal-body .info-label {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .modal-body .info-value {
            color: #ffffff;
            font-weight: 600;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .mb-3 {
            margin-bottom: 24px;
        }

        .communication-panel {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .communication-header {
            padding: 20px 28px;
            background: rgba(59, 130, 246, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .communication-list {
            max-height: 600px;
            overflow-y: auto;
            padding: 20px;
        }

        .communication-item {
            padding: 20px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.5);
            margin-bottom: 12px;
            border-left: 4px solid #3b82f6;
            color: #ffffff;
        }

        .communication-item.from-if {
            border-left-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.15);
        }

        .communication-item.from-if .communication-author,
        .communication-item.from-if .communication-message {
            color: #e0f7fa;
        }

        .communication-item.from-if .communication-time {
            color: #a5d6e0;
        }

        .communication-item.from-rpps {
            border-left-color: #16a34a;
            background: #f0fdf4;
        }

        .communication-item.system {
            border-left-color: #ea580c;
            background: #fff7ed;
        }

        .communication-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .communication-author {
            font-weight: 700;
            color: #18181b;
            font-size: 0.875rem;
        }

        .communication-time {
            font-size: 0.75rem;
            color: #71717a;
        }

        .communication-message {
            color: #3f3f46;
            line-height: 1.6;
            font-size: 0.9375rem;
        }

        .communication-input-area {
            padding: 32px;
            border-top: 2px solid #e4e4e7;
            background: #f4f4f5;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #27272a;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .form-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px 16px;
            border: 2px solid #e4e4e7;
            border-radius: 8px;
            font-size: 0.9375rem;
            color: #18181b;
            background: white;
            resize: vertical;
            font-family: inherit;
            line-height: 1.6;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #2c5282;
            box-shadow: 0 0 0 3px rgba(44, 82, 130, 0.1);
        }

        .btn-outline {
            background: transparent;
            color: #1e3a5f;
            border: 2px solid #2c5282;
        }

        .btn-outline:hover {
            background: #f0f4f8;
            border-color: #1e3a5f;
        }

        .btn-success {
            background: #16a34a;
            color: white;
            box-shadow: 0 2px 8px rgba(22, 163, 74, 0.2);
        }

        .btn-success:hover {
            background: #15803d;
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #dc2626;
            color: white;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
        }

        .btn-danger:hover {
            background: #b91c1c;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
            transform: translateY(-1px);
        }

        .btn-icon {
            padding: 10px;
            width: 40px;
            height: 40px;
        }

        @media (max-width: 1024px) {
            .grid-4,
            .stats-grid-premium {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .categories-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .hero-welcome {
                flex-direction: column;
                gap: 24px;
                text-align: center;
            }
            
            .hero-stats-mini {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .navbar-modern {
                padding: 0 24px;
                height: auto;
                flex-wrap: wrap;
                padding-top: 16px;
                padding-bottom: 16px;
            }
            
            .main-container {
                padding: 24px;
            }
            
            .grid-4,
            .grid-2,
            .stats-grid-premium,
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .folders-container {
                grid-template-columns: 1fr;
            }
            
            .hero-welcome {
                padding: 24px;
            }
            
            .hero-title {
                font-size: 1.5rem;
            }
            
            .section-header {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            
            .category-card {
                padding: 24px;
            }
            
            .category-icon {
                width: 56px;
                height: 56px;
            }
        }

        /* ========================================
           BOTÃO FULLSCREEN - PREMIUM
           ======================================== */
        .fullscreen-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            cursor: pointer;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #60a5fa;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.4),
                0 8px 32px rgba(59, 130, 246, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.1) inset;
            backdrop-filter: blur(20px);
            transform: perspective(500px) rotateX(5deg);
        }

        .fullscreen-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.5), transparent);
            border-radius: 16px 16px 0 0;
        }

        .fullscreen-btn:hover {
            transform: perspective(500px) rotateX(0deg) translateY(-4px) scale(1.05);
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.5),
                0 16px 48px rgba(59, 130, 246, 0.25),
                0 0 60px rgba(59, 130, 246, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
            color: #93c5fd;
        }

        .fullscreen-btn:active {
            transform: perspective(500px) rotateX(0deg) translateY(-2px) scale(1.02);
        }

        .fullscreen-btn svg {
            width: 24px;
            height: 24px;
            transition: all 0.3s ease;
        }

        .fullscreen-btn.is-fullscreen {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(15, 23, 42, 0.98) 100%);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .fullscreen-btn .icon-expand,
        .fullscreen-btn.is-fullscreen .icon-compress {
            display: block;
        }

        .fullscreen-btn .icon-compress,
        .fullscreen-btn.is-fullscreen .icon-expand {
            display: none;
        }

        .fullscreen-btn-tooltip {
            position: absolute;
            right: 68px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(15, 23, 42, 0.95);
            color: #e2e8f0;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .fullscreen-btn-tooltip::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            border: 6px solid transparent;
            border-left-color: rgba(15, 23, 42, 0.95);
        }

        .fullscreen-btn:hover .fullscreen-btn-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* CONTROLE DE ZOOM */
        .zoom-control {
            position: fixed;
            bottom: 90px;
            right: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            z-index: 9998;
        }

        .zoom-container {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%);
            border: 1px solid rgba(14, 165, 233, 0.3);
            border-radius: 16px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 8px 32px rgba(14, 165, 233, 0.15);
            backdrop-filter: blur(20px);
        }

        .zoom-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(14, 165, 233, 0.5), transparent);
            border-radius: 16px 16px 0 0;
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(14, 165, 233, 0.2);
            color: #38bdf8;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .zoom-btn:hover {
            background: rgba(14, 165, 233, 0.25);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3);
        }

        .zoom-btn:active {
            transform: scale(0.95);
        }

        .zoom-value {
            font-size: 0.7rem;
            font-weight: 600;
            color: #38bdf8;
            background: rgba(14, 165, 233, 0.1);
            padding: 6px 8px;
            border-radius: 8px;
            min-width: 42px;
            text-align: center;
        }

        .zoom-reset {
            width: 36px;
            height: 28px;
            border-radius: 8px;
            background: rgba(14, 165, 233, 0.05);
            border: 1px solid rgba(14, 165, 233, 0.15);
            color: #38bdf8;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 0.65rem;
            opacity: 0.7;
        }

        .zoom-reset:hover {
            background: rgba(14, 165, 233, 0.2);
            opacity: 1;
        }

        /* ========================================
           MODAL DE PERFIL DO USUÁRIO
           ======================================== */
        .profile-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .profile-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .profile-modal {
            position: relative;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.95) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 24px;
            width: 95%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 100px rgba(59, 130, 246, 0.1);
        }

        .profile-modal-overlay.active .profile-modal {
            transform: scale(1) translateY(0);
        }

        .profile-modal-header {
            padding: 24px 28px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .profile-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f1f5f9;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-modal-title svg {
            color: #60a5fa;
        }

        .profile-modal-close {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #f87171;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .profile-modal-close:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: scale(1.05);
        }

        .profile-modal-body {
            padding: 28px;
        }

        .profile-photo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .profile-photo-wrapper {
            position: relative;
            width: 120px;
            height: 120px;
            margin-bottom: 16px;
        }

        .profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(139, 92, 246, 0.3) 100%);
            border: 3px solid rgba(59, 130, 246, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 700;
            color: #60a5fa;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-photo-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border: 2px solid rgba(15, 23, 42, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .profile-photo-edit:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .profile-photo-edit input {
            display: none;
        }

        .profile-form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .profile-form-grid .full-width {
            grid-column: span 2;
        }

        .profile-form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .profile-form-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .profile-form-input {
            padding: 12px 16px;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            color: #f1f5f9;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .profile-form-input:focus {
            outline: none;
            border-color: rgba(59, 130, 246, 0.5);
            background: rgba(30, 41, 59, 0.8);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .profile-form-input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .profile-form-input::placeholder {
            color: #64748b;
        }

        .profile-modal-footer {
            padding: 20px 28px;
            border-top: 1px solid rgba(148, 163, 184, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn-profile-save {
            padding: 12px 28px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-profile-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-profile-cancel {
            padding: 12px 24px;
            background: rgba(100, 116, 139, 0.2);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            color: #94a3b8;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-profile-cancel:hover {
            background: rgba(100, 116, 139, 0.3);
            color: #f1f5f9;
        }

        .profile-loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 24px;
            z-index: 10;
        }

        .profile-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(59, 130, 246, 0.2);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 640px) {
            .profile-form-grid {
                grid-template-columns: 1fr;
            }
            .profile-form-grid .full-width {
                grid-column: span 1;
            }
            .profile-modal {
                border-radius: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Canvas para Animação Tech de Partículas -->
    <canvas id="particles-canvas"></canvas>

    <!-- Navbar Principal -->
    <nav class="navbar-modern">
        <div class="navbar-brand">
            <img src="{{ url_for('static', filename='images/só o simbolo.png') }}?v=10" 
                 alt="Logo" 
                 style="height: 80px; object-fit: contain; margin-right: 16px; filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));"
                 onerror="this.style.display='none'">
            <div>
                <div class="brand-title">Smart Credenciamento</div>
                <div class="brand-subtitle">Regime Próprio de Previdência Social</div>
            </div>
        </div>
        
        <div class="navbar-actions">
            <button class="btn btn-secondary" onclick="window.location.href='/modelos-documentos'" style="margin-right: 12px; background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); display: inline-flex; align-items: center; gap: 8px;">
                <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
                Modelos de Documentos
            </button>
            <button class="btn btn-secondary" onclick="openValidadorModal()" style="margin-right: 12px; background: rgba(255, 255, 255, 0.1); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.2); display: inline-flex; align-items: center; gap: 8px;">
                <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                Validador de Assinatura
            </button>
            <div class="user-profile" onclick="openProfileModal()" style="cursor: pointer;" title="Clique para editar seu perfil">
                <div class="user-avatar" id="navUserAvatar">{{ session.user_name[0].upper() }}</div>
                <div>
                    <div class="user-name">{{ session.user_name }}</div>
                    <div class="user-role">RPPS</div>
                </div>
            </div>
            <button class="btn btn-secondary btn-sm" onclick="logout()">Sair</button>
        </div>
    </nav>

    <!-- Container Principal -->
    <div class="main-container">
        
        <!-- Hero Welcome Section -->
        <div class="hero-welcome">
            <div class="hero-content">
                <h1 class="hero-title">
                    Bem-vindo, <span class="welcome-name">{{ session.user_name }}</span>
                </h1>
                <p class="hero-subtitle">
                    Painel de Credenciamento de Instituições Financeiras • <span id="current-datetime"></span>
                </p>
            </div>
            <div class="hero-stats-mini">
                <div class="mini-stat">
                    <span class="mini-stat-value" id="hero-total">0</span>
                    <span class="mini-stat-label">Processos</span>
                </div>
                <div class="mini-stat-divider"></div>
                <div class="mini-stat">
                    <span class="mini-stat-value" id="hero-pending">0</span>
                    <span class="mini-stat-label">Pendentes</span>
                </div>
                <div class="mini-stat-divider"></div>
                <div class="mini-stat success">
                    <span class="mini-stat-value" id="hero-approved">0</span>
                    <span class="mini-stat-label">Aprovados</span>
                </div>
            </div>
        </div>

        <!-- Cards de Estatísticas Premium -->
        <div class="stats-grid-premium" id="stats-section">
            <div class="stat-card-premium stat-total">
                <div class="stat-card-glow"></div>
                <div class="stat-card-content">
                    <div class="stat-icon-wrapper">
                        <div class="stat-icon-bg">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/>
                                <path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/>
                                <path d="M18 12a2 2 0 0 0 0 4h4v-4h-4z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Total de Processos</span>
                        <div class="stat-value-row">
                            <span class="stat-value" id="stat-total">0</span>
                            <span class="stat-trend up">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 6l-9.5 9.5-5-5L1 18"/>
                                    <path d="M17 6h6v6"/>
                                </svg>
                                Ativos
                            </span>
                        </div>
                    </div>
                </div>
                <div class="stat-progress">
                    <div class="stat-progress-bar" style="width: 100%; background: linear-gradient(90deg, #3b82f6, #60a5fa);"></div>
                </div>
            </div>
            
            <div class="stat-card-premium stat-analysis">
                <div class="stat-card-glow"></div>
                <div class="stat-card-content">
                    <div class="stat-icon-wrapper warning">
                        <div class="stat-icon-bg">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <div class="stat-pulse warning"></div>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Em Análise</span>
                        <div class="stat-value-row">
                            <span class="stat-value warning" id="stat-review">0</span>
                            <span class="stat-trend warning">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M12 1v2m0 18v2M1 12h2m18 0h2"/>
                                </svg>
                                Aguardando
                            </span>
                        </div>
                    </div>
                </div>
                <div class="stat-progress">
                    <div class="stat-progress-bar" id="progress-analysis" style="width: 0%; background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>
                </div>
            </div>
            
            <div class="stat-card-premium stat-approved">
                <div class="stat-card-glow"></div>
                <div class="stat-card-content">
                    <div class="stat-icon-wrapper success">
                        <div class="stat-icon-bg">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Aprovados</span>
                        <div class="stat-value-row">
                            <span class="stat-value success" id="stat-approved">0</span>
                            <span class="stat-trend success">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                Concluídos
                            </span>
                        </div>
                    </div>
                </div>
                <div class="stat-progress">
                    <div class="stat-progress-bar" id="progress-approved" style="width: 0%; background: linear-gradient(90deg, #10b981, #34d399);"></div>
                </div>
            </div>
            
            <div class="stat-card-premium stat-returned">
                <div class="stat-card-glow"></div>
                <div class="stat-card-content">
                    <div class="stat-icon-wrapper danger">
                        <div class="stat-icon-bg">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                                <path d="M21 3v5h-5"/>
                                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                                <path d="M3 21v-5h5"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">Devolvidos</span>
                        <div class="stat-value-row">
                            <span class="stat-value danger" id="stat-returned">0</span>
                            <span class="stat-trend danger">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                Revisar
                            </span>
                        </div>
                    </div>
                </div>
                <div class="stat-progress">
                    <div class="stat-progress-bar" id="progress-returned" style="width: 0%; background: linear-gradient(90deg, #ef4444, #f87171);"></div>
                </div>
            </div>
        </div>

        <!-- Seção de Categorias -->
        <div class="section-header">
            <div class="section-title-wrapper">
                <h2 class="section-title">Categorias de Credenciamento</h2>
                <p class="section-subtitle">Selecione uma categoria para visualizar os processos</p>
            </div>
        </div>

        <!-- Cards de Categorias Premium -->
        <div class="categories-grid" id="folders-section">
            <div class="category-card gestor" id="folder-gestor" onclick="selectFolder('gestor')">
                <div class="category-card-bg"></div>
                <div class="category-content">
                    <div class="category-icon-wrapper">
                        <div class="category-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                <path d="M2 17l10 5 10-5"/>
                                <path d="M2 12l10 5 10-5"/>
                            </svg>
                        </div>
                        <div class="category-badge" id="badge-gestor">0</div>
                    </div>
                    <div class="category-info">
                        <h3 class="category-title">GESTOR</h3>
                        <p class="category-description">Gestão de fundos e recursos previdenciários</p>
                    </div>
                    <div class="category-footer">
                        <div class="category-stats">
                            <span class="category-stat">
                                <span class="dot pending"></span>
                                <span id="gestor-pending">0</span> pendentes
                            </span>
                        </div>
                        <div class="category-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="category-shine"></div>
            </div>
            
            <div class="category-card distribuidor" id="folder-distribuidor" onclick="selectFolder('distribuidor')">
                <div class="category-card-bg"></div>
                <div class="category-content">
                    <div class="category-icon-wrapper">
                        <div class="category-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M2 12h20"/>
                                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                            </svg>
                        </div>
                        <div class="category-badge" id="badge-distribuidor">0</div>
                    </div>
                    <div class="category-info">
                        <h3 class="category-title">DISTRIBUIDOR</h3>
                        <p class="category-description">Distribuição e intermediação de ativos</p>
                    </div>
                    <div class="category-footer">
                        <div class="category-stats">
                            <span class="category-stat">
                                <span class="dot pending"></span>
                                <span id="distribuidor-pending">0</span> pendentes
                            </span>
                        </div>
                        <div class="category-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="category-shine"></div>
            </div>
            
            <div class="category-card administrador" id="folder-administrador" onclick="selectFolder('administrador')">
                <div class="category-card-bg"></div>
                <div class="category-content">
                    <div class="category-icon-wrapper">
                        <div class="category-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                <line x1="8" y1="21" x2="16" y2="21"/>
                                <line x1="12" y1="17" x2="12" y2="21"/>
                            </svg>
                        </div>
                        <div class="category-badge" id="badge-administrador">0</div>
                    </div>
                    <div class="category-info">
                        <h3 class="category-title">ADMINISTRADOR</h3>
                        <p class="category-description">Administração e custódia de ativos</p>
                    </div>
                    <div class="category-footer">
                        <div class="category-stats">
                            <span class="category-stat">
                                <span class="dot pending"></span>
                                <span id="administrador-pending">0</span> pendentes
                            </span>
                        </div>
                        <div class="category-arrow">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="category-shine"></div>
            </div>
        </div>
        
        <!-- CONTEÚDO DINÂMICO (filtros e tabela aparecerão aqui ao clicar em uma pasta) -->
        <div id="folder-content" style="display: none;">
            <!-- Cabeçalho da Pasta -->
            <div class="card-modern" style="margin-bottom: 24px; background: linear-gradient(135deg, #0c2340 0%, #1e3a5f 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 4px;" id="folder-title"></h2>
                        <p style="opacity: 0.9; font-size: 0.875rem;" id="folder-description"></p>
                    </div>
                    <button class="btn btn-secondary" onclick="voltarParaPastas()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white;">
                        ← Voltar
                    </button>
                </div>
            </div>

        <!-- Filtros e Ações -->
        <div class="card-modern mb-4" style="background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(255, 255, 255, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                    <button class="filter-btn active" id="filter-all" onclick="filterProcesses('all')">
                        Todos
                    </button>
                    <button class="filter-btn" id="filter-submitted" onclick="filterProcesses('submitted')">
                        Enviados
                    </button>
                    <button class="filter-btn" id="filter-in_review" onclick="filterProcesses('in_review')">
                        Em Análise
                    </button>
                    <button class="filter-btn" id="filter-returned" onclick="filterProcesses('returned')">
                        Devolvidos
                    </button>
                    <button class="filter-btn" id="filter-approved" onclick="filterProcesses('approved')">
                        Aprovados
                    </button>
                </div>
                
                <div style="display: flex; gap: 12px;">
                    <input type="search" class="form-input search-input-dark" placeholder="Buscar Processo..." 
                           style="max-width: 300px;" onkeyup="searchProcesses(this.value)">
                </div>
            </div>
        </div>

        <!-- Tabela de Processos -->
        <div class="table-container">
            <table class="table-modern">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Instituição Financeira</th>
                        <th>Categoria</th>
                        <th>Status</th>
                        <th>Documentos</th>
                        <th>Data de Envio</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="processes-table-body">
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 48px; color: #71717a;">
                            Carregando Processos...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        </div><!-- FIM do folder-content -->
    </div><!-- FIM do main-container -->

    <!-- Modal de Detalhes do Processo - Design Ultra Moderno com Tabs -->
    <div id="processModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 1100px; max-height: 92vh; display: flex; flex-direction: column; overflow: hidden;">
            <!-- Header Compacto Premium -->
            <div class="modal-header" style="padding: 16px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); flex-shrink: 0;">
                <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
                    <!-- Ícone do Processo -->
                    <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);">
                        <svg style="width: 24px; height: 24px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <div style="flex: 1;">
                        <h2 class="modal-title" style="font-size: 1.25rem; font-weight: 800; margin: 0;">Processo #<span id="modal-process-id" style="color: #60a5fa;"></span></h2>
                        <p style="color: rgba(255,255,255,0.7); margin-top: 2px; font-size: 0.8125rem;" id="modal-process-institution"></p>
                    </div>
                    <!-- Info Pills Compactos -->
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div id="modal-status-badge"></div>
                        <div style="padding: 6px 12px; background: rgba(245, 158, 11, 0.2); border-radius: 20px; border: 1px solid rgba(245, 158, 11, 0.3);">
                            <span style="color: #fbbf24; font-size: 0.75rem; font-weight: 600;" id="modal-category"></span>
                        </div>
                        <div style="padding: 6px 12px; background: rgba(16, 185, 129, 0.2); border-radius: 20px; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <span style="color: #34d399; font-size: 0.75rem; font-weight: 600;" id="modal-created-at"></span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-icon" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; margin-left: 16px;" onclick="closeModal()">
                    <svg style="width: 20px; height: 20px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            
            <!-- Tabs de Navegação Ultra Modernas -->
            <div style="padding: 0 20px; background: rgba(15, 23, 42, 0.6); border-bottom: 1px solid rgba(255,255,255,0.08); flex-shrink: 0;">
                <div class="process-tabs" style="display: flex; gap: 4px;">
                    <button class="process-tab active" data-tab="documents" onclick="switchProcessTab('documents')" style="padding: 14px 20px; background: transparent; border: none; color: #60a5fa; font-weight: 700; font-size: 0.875rem; cursor: pointer; position: relative; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                        <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
                        Documentos
                        <span id="doc-count-badge" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; font-size: 0.6875rem; padding: 2px 6px; border-radius: 10px; font-weight: 700;">0</span>
                    </button>
                    <button class="process-tab" data-tab="history" onclick="switchProcessTab('history')" style="padding: 14px 20px; background: transparent; border: none; color: rgba(255,255,255,0.5); font-weight: 600; font-size: 0.875rem; cursor: pointer; position: relative; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                        <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        Histórico
                    </button>
                    <button class="process-tab" data-tab="actions" onclick="switchProcessTab('actions')" style="padding: 14px 20px; background: transparent; border: none; color: rgba(255,255,255,0.5); font-weight: 600; font-size: 0.875rem; cursor: pointer; position: relative; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                        <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        Ações
                    </button>
                    <button class="process-tab" data-tab="communication" onclick="switchProcessTab('communication')" style="padding: 14px 20px; background: transparent; border: none; color: rgba(255,255,255,0.5); font-weight: 600; font-size: 0.875rem; cursor: pointer; position: relative; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                        <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                        Comunicação
                        <span id="msg-count-badge" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; font-size: 0.6875rem; padding: 2px 6px; border-radius: 10px; font-weight: 700; display: none;">0</span>
                    </button>
                    <button class="process-tab" id="tab-btn-termo" data-tab="termo" onclick="switchProcessTab('termo')" style="padding: 14px 20px; background: transparent; border: none; color: rgba(255,255,255,0.5); font-weight: 600; font-size: 0.875rem; cursor: pointer; position: relative; display: none; align-items: center; gap: 8px; transition: all 0.3s ease;">
                        <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                        Termo
                        <span id="termo-count-badge" style="background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%); color: white; font-size: 0.6875rem; padding: 2px 6px; border-radius: 10px; font-weight: 700;">0</span>
                    </button>
                    <button class="process-tab" data-tab="ai-analysis" onclick="switchProcessTab('ai-analysis')" style="padding: 14px 20px; background: transparent; border: none; color: rgba(255,255,255,0.5); font-weight: 600; font-size: 0.875rem; cursor: pointer; position: relative; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                        <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                        Análise IA
                    </button>
                </div>
            </div>
            
            <!-- Conteúdo das Tabs -->
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 20px;">
                
                <!-- Tab: Documentos (Principal) -->
                <div id="tab-documents" class="tab-content active" style="display: block;">
                    <div style="background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3 style="font-size: 0.9375rem; font-weight: 700; color: #ffffff; display: flex; align-items: center; gap: 8px; margin: 0;">
                                <svg style="width: 18px; height: 18px; stroke: #22d3ee; fill: none;" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                Documentos Enviados pela Instituição Financeira
                            </h3>
                            <button id="btn-download-zip" onclick="downloadAllDocumentsZip()" style="padding: 8px 16px; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; font-weight: 600; font-size: 0.75rem; cursor: pointer; display: none; align-items: center; gap: 6px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);" title="Baixar todos os documentos em um arquivo ZIP">
                                <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                                Baixar Todos (ZIP)
                            </button>
                        </div>
                        <div id="modal-documents" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; max-height: 320px; overflow-y: auto;">
                            <p style="color: rgba(255, 255, 255, 0.5); text-align: center; padding: 24px; font-size: 0.875rem; grid-column: span 2;">Carregando documentos...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tab: Termo de Credenciamento (Documentos Especiais) -->
                <div id="tab-termo" class="tab-content" style="display: none;">
                    <div style="background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 16px; padding: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="font-size: 1rem; font-weight: 700; color: #ffffff; display: flex; align-items: center; gap: 10px; margin: 0;">
                                <svg style="width: 20px; height: 20px; stroke: #a855f7; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                                Termo de Credenciamento
                            </h3>
                            <button onclick="openAddSpecialDocModal()" style="padding: 10px 18px; border-radius: 10px; background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%); border: none; color: white; font-weight: 600; font-size: 0.8125rem; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(168, 85, 247, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(168, 85, 247, 0.4)';">
                                <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
                                Adicionar Versão
                            </button>
                        </div>
                        
                        <p style="color: rgba(255,255,255,0.6); font-size: 0.8125rem; margin-bottom: 20px; line-height: 1.6; padding: 12px 16px; background: rgba(168, 85, 247, 0.1); border-radius: 10px; border-left: 3px solid #a855f7;">
                            <svg style="width: 16px; height: 16px; stroke: #a855f7; fill: none; vertical-align: middle; margin-right: 6px;" viewBox="0 0 24 24"><path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            Fluxo de assinaturas do Termo de Credenciamento. Acompanhe todas as versões e o status de cada documento.
                        </p>
                        
                        <!-- Timeline de versões do documento especial -->
                        <div id="special-docs-timeline" style="display: flex; flex-direction: column; gap: 16px; max-height: 400px; overflow-y: auto;">
                            <p style="color: rgba(255,255,255,0.5); text-align: center; padding: 24px;">Carregando...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tab: Histórico -->
                <div id="tab-history" class="tab-content" style="display: none;">
                    <div style="background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 24px;">
                        <h3 style="font-size: 1rem; margin-bottom: 20px; font-weight: 700; color: #ffffff; display: flex; align-items: center; gap: 10px;">
                            <svg style="width: 20px; height: 20px; stroke: #8b5cf6; fill: none;" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            Linha do Tempo do Processo
                        </h3>
                        <div id="history-timeline" style="position: relative; padding-left: 40px;">
                            <p style="color: rgba(255, 255, 255, 0.5); text-align: center; padding: 24px; font-size: 0.875rem;">Carregando histórico...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tab: Ações -->
                <div id="tab-actions" class="tab-content" style="display: none;">
                    <!-- Linha Superior: Devolver para IF e Solicitar Documento -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                        <!-- Devolver para IF -->
                        <div onclick="openReturnModal()" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%); border: 1px solid rgba(245, 158, 11, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s ease; text-align: center;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(245, 158, 11, 0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);">
                                <svg style="width: 24px; height: 24px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                            </div>
                            <h4 style="color: #ffffff; font-weight: 700; font-size: 0.9375rem; margin-bottom: 4px;">Devolver para IF</h4>
                            <p style="color: rgba(255,255,255,0.5); font-size: 0.6875rem;">Solicitar correções</p>
                        </div>
                        
                        <!-- Solicitar Documento -->
                        <div onclick="openRequestDocModal()" style="background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(96, 165, 250, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s ease; text-align: center;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(96, 165, 250, 0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; box-shadow: 0 6px 16px rgba(96, 165, 250, 0.4);">
                                <svg style="width: 24px; height: 24px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
                            </div>
                            <h4 style="color: #ffffff; font-weight: 700; font-size: 0.9375rem; margin-bottom: 4px;">Solicitar Documento</h4>
                            <p style="color: rgba(255,255,255,0.5); font-size: 0.6875rem;">Pedir arquivo adicional</p>
                        </div>
                    </div>
                    
                    <!-- Linha Inferior: Aprovar e Rejeitar -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <!-- Aprovar -->
                        <div onclick="approveProcess()" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s ease; text-align: center;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(16, 185, 129, 0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);">
                                <svg style="width: 24px; height: 24px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
                            </div>
                            <h4 style="color: #ffffff; font-weight: 700; font-size: 0.9375rem; margin-bottom: 4px;">Aprovar</h4>
                            <p style="color: rgba(255,255,255,0.5); font-size: 0.6875rem;">Credenciamento OK</p>
                        </div>
                        
                        <!-- Rejeitar -->
                        <div onclick="rejectProcess()" style="background: linear-gradient(135deg, rgba(220, 38, 38, 0.15) 0%, rgba(239, 68, 68, 0.15) 100%); border: 1px solid rgba(220, 38, 38, 0.4); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s ease; text-align: center;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(220, 38, 38, 0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4);">
                                <svg style="width: 24px; height: 24px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>
                            </div>
                            <h4 style="color: #ffffff; font-weight: 700; font-size: 0.9375rem; margin-bottom: 4px;">Rejeitar</h4>
                            <p style="color: rgba(255,255,255,0.5); font-size: 0.6875rem;">Negar credenciamento</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tab: Comunicação -->
                <div id="tab-communication" class="tab-content" style="display: none;">
                    <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 16px; overflow: hidden; height: 100%;">
                        <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 14px 20px;">
                            <h3 style="font-size: 1rem; color: white; font-weight: 700; display: flex; align-items: center; gap: 8px; margin: 0;">
                                <svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                                Comunicação com Instituição Financeira
                            </h3>
                        </div>
                        <div id="communications-list" style="background: rgba(15, 23, 42, 0.5); height: 200px; overflow-y: auto; padding: 16px;">
                            <p style="text-align: center; color: rgba(255, 255, 255, 0.5); padding: 24px; font-size: 0.875rem;">Nenhuma Comunicação Ainda</p>
                        </div>
                        <div style="padding: 14px 20px; background: rgba(30, 41, 59, 0.6); border-top: 1px solid rgba(139, 92, 246, 0.2);">
                            <div style="display: flex; gap: 12px;">
                                <textarea id="new-message-input" placeholder="Digite sua mensagem para a Instituição Financeira..." rows="2" style="flex: 1; border: 1px solid rgba(139, 92, 246, 0.3); background: rgba(15, 23, 42, 0.8); color: #ffffff; resize: none; padding: 10px 14px; font-size: 0.875rem; border-radius: 10px;"></textarea>
                                <button onclick="sendMessage()" style="padding: 0 20px; border-radius: 10px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border: none; color: white; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);">
                                    <svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                                    Enviar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab: Análise IA -->
                <div id="tab-ai-analysis" class="tab-content" style="display: none;">
                    <div style="text-align: center; padding: 40px;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);">
                            <svg style="width: 40px; height: 40px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                        </div>
                        <h3 style="color: #ffffff; font-size: 1.25rem; font-weight: 800; margin-bottom: 8px;">Análise Inteligente com IA</h3>
                        <p style="color: rgba(255,255,255,0.6); font-size: 0.9375rem; margin-bottom: 24px; max-width: 400px; margin-left: auto; margin-right: auto;">
                            Utilize nossa IA avançada para analisar automaticamente todos os documentos do processo
                        </p>
                        <div id="ai-buttons-container" style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
                            <button id="btn-processar-ia" onclick="startAIAnalysis()" style="padding: 14px 28px; border-radius: 12px; background: linear-gradient(135deg, #16a34a 0%, #10b981 100%); border: none; color: white; font-weight: 700; font-size: 0.9375rem; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 8px 24px rgba(22, 163, 74, 0.4);">
                                <svg style="width: 20px; height: 20px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                                Processar Agora
                            </button>
                            <button id="btn-ver-relatorio" onclick="viewAnalysisReport()" style="padding: 14px 28px; border-radius: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; font-weight: 700; font-size: 0.9375rem; cursor: pointer; display: none; align-items: center; gap: 10px; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);">
                                <svg style="width: 20px; height: 20px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                Ver Relatório
                            </button>
                        </div>
                        <p id="ai-status-message" style="color: rgba(255,255,255,0.5); font-size: 0.8125rem; margin-top: 16px;"></p>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    
    <!-- Modal: Assinador Digital (Independente) -->
    <div id="assinadorModal" class="modal-overlay" style="display: none; z-index: 10001;">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%); border-radius: 20px; border: 2px solid rgba(16, 185, 129, 0.4); display: flex; flex-direction: column;">
            <div class="modal-header" style="padding: 20px; border-bottom: 1px solid rgba(16, 185, 129, 0.3); background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.15) 100%); display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 14px;">
                    <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);">
                        <svg style="width: 26px; height: 26px; stroke: white; fill: none;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                    </div>
                    <div>
                        <h3 style="color: white; font-size: 1.25rem; font-weight: 800; margin: 0;">Assinador Digital</h3>
                        <p style="color: rgba(255,255,255,0.6); font-size: 0.8125rem; margin: 0;">Assine PDFs com certificado ICP-Brasil</p>
                    </div>
                </div>
                <button onclick="closeAssinadorModal()" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 40px; height: 40px; border-radius: 10px; cursor: pointer; font-size: 1.25rem;">✕</button>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 24px;">
                
                <!-- Seleção de Tipo de Certificado -->
                <div style="display: flex; gap: 16px; justify-content: center; margin-bottom: 28px;">
                    <button id="btn-cert-a3" onclick="selectCertType('a3')" class="cert-type-btn active" style="flex: 1; max-width: 220px; padding: 20px; border-radius: 16px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(5, 150, 105, 0.3) 100%); border: 2px solid #10b981; color: white; cursor: pointer; transition: all 0.3s ease;">
                        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                            <svg style="width: 24px; height: 24px; stroke: white; fill: none;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                        </div>
                        <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px;">Certificado A3</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">Token / Smartcard</div>
                    </button>
                    
                    <button id="btn-cert-a1" onclick="selectCertType('a1')" class="cert-type-btn" style="flex: 1; max-width: 220px; padding: 20px; border-radius: 16px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.2); color: rgba(255,255,255,0.7); cursor: pointer; transition: all 0.3s ease;">
                        <div style="width: 48px; height: 48px; background: rgba(255, 255, 255, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                            <svg style="width: 24px; height: 24px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                        </div>
                        <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px;">Certificado A1</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">Arquivo .pfx/.p12</div>
                    </button>
                </div>
                
                <!-- Área de Assinatura A3 (Token/Smartcard) -->
                <div id="signer-area-a3" style="display: block;">
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 18px; margin-bottom: 18px;">
                        <div style="display: flex; align-items: flex-start; gap: 14px;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <svg style="width: 20px; height: 20px; stroke: white; fill: none;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            </div>
                            <div>
                                <h4 style="color: #10b981; font-weight: 700; font-size: 0.875rem; margin: 0 0 8px 0;">Como usar o Certificado A3</h4>
                                <ol style="color: rgba(255,255,255,0.8); font-size: 0.8125rem; margin: 0; padding-left: 18px; line-height: 1.7;">
                                    <li><strong>Instale o Fortify</strong> - <a href="https://fortifyapp.com/" target="_blank" style="color: #22d3ee;">Download gratuito</a></li>
                                    <li><strong>Conecte seu token</strong> ou insira o smartcard</li>
                                    <li><strong>Selecione o documento</strong> PDF abaixo</li>
                                    <li><strong>Digite o PIN</strong> quando solicitado</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    
                    <div id="fortify-status" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 14px; margin-bottom: 18px; display: flex; align-items: center; gap: 12px;">
                        <svg style="width: 20px; height: 20px; stroke: #ef4444; fill: none; flex-shrink: 0;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                        <div style="flex: 1;">
                            <div style="color: #ef4444; font-weight: 700; font-size: 0.8125rem;">Fortify não detectado</div>
                            <div style="color: rgba(255,255,255,0.5); font-size: 0.75rem;">Instale o Fortify para usar certificado A3</div>
                        </div>
                        <button onclick="checkFortifyStatus()" style="padding: 6px 14px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-size: 0.75rem; cursor: pointer;">Verificar</button>
                    </div>
                    
                    <div id="a3-cert-selector" style="display: none; margin-bottom: 18px;">
                        <label style="color: rgba(255,255,255,0.8); font-size: 0.8125rem; font-weight: 600; display: block; margin-bottom: 6px;">Certificado Detectado</label>
                        <select id="a3-cert-list" style="width: 100%; padding: 10px; border-radius: 10px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(16, 185, 129, 0.4); color: white; font-size: 0.8125rem;">
                            <option value="">Selecione um certificado...</option>
                        </select>
                    </div>
                </div>
                
                <!-- Área de Assinatura A1 (Upload de .pfx) -->
                <div id="signer-area-a1" style="display: none;">
                    <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.1) 100%); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 18px; margin-bottom: 18px;">
                        <div style="display: flex; align-items: flex-start; gap: 14px;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <svg style="width: 20px; height: 20px; stroke: white; fill: none;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                            </div>
                            <div>
                                <h4 style="color: #3b82f6; font-weight: 700; font-size: 0.875rem; margin: 0 0 6px 0;">Certificado A1 (Arquivo)</h4>
                                <p style="color: rgba(255,255,255,0.7); font-size: 0.8125rem; margin: 0; line-height: 1.5;">
                                    Upload do .pfx ou .p12 + senha. <strong style="color: #22d3ee;">Certificado usado apenas para assinar e descartado.</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 14px;">
                        <label style="color: rgba(255,255,255,0.8); font-size: 0.8125rem; font-weight: 600; display: block; margin-bottom: 6px;">Certificado (.pfx ou .p12)</label>
                        <div id="a1-cert-dropzone" onclick="document.getElementById('a1-cert-file').click()" style="border: 2px dashed rgba(59, 130, 246, 0.4); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s ease;">
                            <input type="file" id="a1-cert-file" accept=".pfx,.p12" style="display: none;" onchange="handleA1CertUpload(this)">
                            <svg style="width: 28px; height: 28px; stroke: #3b82f6; fill: none; margin: 0 auto 6px;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                            <div id="a1-cert-filename" style="color: rgba(255,255,255,0.7); font-size: 0.8125rem;">Clique para selecionar</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 18px;">
                        <label style="color: rgba(255,255,255,0.8); font-size: 0.8125rem; font-weight: 600; display: block; margin-bottom: 6px;">Senha do Certificado</label>
                        <input type="password" id="a1-cert-password" placeholder="Digite a senha" style="width: 100%; padding: 10px; border-radius: 10px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-size: 0.8125rem;">
                    </div>
                    
                    <div id="a1-cert-info" style="display: none; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 14px; margin-bottom: 18px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <svg style="width: 18px; height: 18px; stroke: #10b981; fill: none;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <span style="color: #10b981; font-weight: 700; font-size: 0.8125rem;">Certificado Válido</span>
                        </div>
                        <div id="a1-cert-details" style="font-size: 0.75rem; color: rgba(255,255,255,0.8); line-height: 1.7;"></div>
                    </div>
                </div>
                
                <!-- Upload de Documento para Assinar -->
                <div style="margin-bottom: 18px;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.8125rem; font-weight: 600; display: block; margin-bottom: 6px;">Documento PDF para Assinar</label>
                    <div id="pdf-dropzone" onclick="document.getElementById('signer-pdf-file').click()" style="border: 2px dashed rgba(139, 92, 246, 0.4); border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.3s ease;">
                        <input type="file" id="signer-pdf-file" accept=".pdf" style="display: none;" onchange="handlePdfUpload(this)">
                        <svg style="width: 36px; height: 36px; stroke: #8b5cf6; fill: none; margin: 0 auto 8px;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        <div id="pdf-filename" style="color: rgba(255,255,255,0.7); font-size: 0.875rem;">Clique para selecionar um PDF</div>
                        <div style="color: rgba(255,255,255,0.4); font-size: 0.75rem; margin-top: 4px;">ou arraste e solte aqui</div>
                    </div>
                </div>
                
                <!-- Opções de Assinatura -->
                <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 16px; margin-bottom: 18px;">
                    <h4 style="color: rgba(255,255,255,0.9); font-size: 0.8125rem; font-weight: 700; margin: 0 0 14px 0;">Opções da Assinatura</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px;">
                        <div>
                            <label style="color: rgba(255,255,255,0.7); font-size: 0.75rem; font-weight: 600; display: block; margin-bottom: 4px;">Razão</label>
                            <input type="text" id="signer-reason" value="Documento assinado digitalmente" style="width: 100%; padding: 8px; border-radius: 8px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.15); color: white; font-size: 0.8125rem;">
                        </div>
                        <div>
                            <label style="color: rgba(255,255,255,0.7); font-size: 0.75rem; font-weight: 600; display: block; margin-bottom: 4px;">Local</label>
                            <input type="text" id="signer-location" value="Brasil" style="width: 100%; padding: 8px; border-radius: 8px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.15); color: white; font-size: 0.8125rem;">
                        </div>
                    </div>
                    
                    <div style="margin-top: 14px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="signer-visual" checked style="width: 16px; height: 16px; accent-color: #10b981;">
                            <span style="color: rgba(255,255,255,0.8); font-size: 0.8125rem;">Incluir carimbo visual</span>
                        </label>
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <label style="color: rgba(255,255,255,0.7); font-size: 0.75rem; font-weight: 600; display: block; margin-bottom: 4px;">Posição do Carimbo</label>
                        <select id="signer-position" style="width: 100%; padding: 8px; border-radius: 8px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.15); color: white; font-size: 0.8125rem;">
                            <option value="bottom-right">Canto inferior direito</option>
                            <option value="bottom-left">Canto inferior esquerdo</option>
                            <option value="top-right">Canto superior direito</option>
                            <option value="top-left">Canto superior esquerdo</option>
                            <option value="center-bottom">Centro inferior</option>
                        </select>
                    </div>
                </div>
                
            </div>
            <div class="modal-footer" style="padding: 16px 24px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 12px; justify-content: flex-end;">
                <button onclick="closeAssinadorModal()" style="padding: 12px 24px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-weight: 600; cursor: pointer;">Cancelar</button>
                <button id="btn-sign-document" onclick="signDocumentModal()" disabled style="padding: 12px 32px; border-radius: 10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; color: white; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; opacity: 0.5;">
                    <svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                    Assinar Documento
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Devolver para IF -->
    <div id="returnModal" class="modal-overlay" style="display: none; z-index: 10001;">
        <div class="modal-content" style="max-width: 600px; background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="modal-header" style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                        <svg style="width: 20px; height: 20px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                    </div>
                    <h3 style="color: white; font-size: 1.125rem; font-weight: 700; margin: 0;">Devolver Processo para IF</h3>
                </div>
                <button onclick="closeReturnModal()" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 36px; height: 36px; border-radius: 8px; cursor: pointer;">✕</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div style="margin-bottom: 16px;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.875rem; font-weight: 600; display: block; margin-bottom: 8px;">
                        Motivo da Devolução *
                    </label>
                    <textarea id="return-reason" rows="4" placeholder="Descreva o motivo da devolução e as correções necessárias..." style="width: 100%; padding: 12px; border-radius: 10px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-size: 0.875rem; resize: vertical;"></textarea>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.875rem; font-weight: 600; display: block; margin-bottom: 8px;">
                        Documentos com Problema (opcional)
                    </label>
                    <div id="return-docs-list" style="max-height: 200px; overflow-y: auto; background: rgba(15, 23, 42, 0.6); border-radius: 10px; padding: 12px; border: 1px solid rgba(255, 255, 255, 0.1);">
                        <p style="color: rgba(255,255,255,0.5); text-align: center; font-size: 0.8125rem;">Carregando documentos...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding: 16px 20px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 12px; justify-content: flex-end;">
                <button onclick="closeReturnModal()" style="padding: 10px 20px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-weight: 600; cursor: pointer;">Cancelar</button>
                <button onclick="submitReturn()" style="padding: 10px 20px; border-radius: 8px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: none; color: white; font-weight: 600; cursor: pointer;">Devolver Processo</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Solicitar Documento -->
    <div id="requestDocModal" class="modal-overlay" style="display: none; z-index: 10001;">
        <div class="modal-content" style="max-width: 500px; background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="modal-header" style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                        <svg style="width: 20px; height: 20px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
                    </div>
                    <h3 style="color: white; font-size: 1.125rem; font-weight: 700; margin: 0;">Solicitar Documento Adicional</h3>
                </div>
                <button onclick="closeRequestDocModal()" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 36px; height: 36px; border-radius: 8px; cursor: pointer;">✕</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div style="margin-bottom: 16px;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.875rem; font-weight: 600; display: block; margin-bottom: 8px;">
                        Qual documento você precisa? *
                    </label>
                    <textarea id="request-doc-description" rows="4" placeholder="Descreva o documento que precisa ser enviado pela IF..." style="width: 100%; padding: 12px; border-radius: 10px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-size: 0.875rem; resize: vertical;"></textarea>
                </div>
            </div>
            <div class="modal-footer" style="padding: 16px 20px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 12px; justify-content: flex-end;">
                <button onclick="closeRequestDocModal()" style="padding: 10px 20px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-weight: 600; cursor: pointer;">Cancelar</button>
                <button onclick="submitRequestDoc()" style="padding: 10px 20px; border-radius: 8px; background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); border: none; color: white; font-weight: 600; cursor: pointer;">Solicitar Documento</button>
            </div>
        </div>
    </div>
    
    <!-- Modal: Visualização de Documento -->
    <div id="docPreviewModal" class="modal-overlay" style="display: none; z-index: 10001;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); display: flex; flex-direction: column;">
            <div class="modal-header" style="padding: 16px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;">
                <h3 id="doc-preview-title" style="color: white; font-size: 1rem; font-weight: 700; margin: 0;">Visualização do Documento</h3>
                <div style="display: flex; gap: 8px;">
                    <a id="doc-preview-download" href="#" target="_blank" style="padding: 8px 16px; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; font-size: 0.8125rem; font-weight: 600; display: inline-flex; align-items: center; gap: 6px;">
                        <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                        Baixar
                    </a>
                    <button onclick="closeDocPreviewModal()" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 36px; height: 36px; border-radius: 8px; cursor: pointer;">✕</button>
                </div>
            </div>
            <div class="modal-body" style="flex: 1; overflow: hidden; padding: 0;">
                <iframe id="doc-preview-iframe" src="" style="width: 100%; height: 100%; min-height: 500px; border: none; background: white;"></iframe>
            </div>
        </div>
    </div>
    
    <!-- Modal: Adicionar Documento Especial (RPPS) -->
    <div id="addSpecialDocModal" class="modal-overlay" style="display: none; z-index: 10002;">
        <div class="modal-content" style="max-width: 550px; background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%); border-radius: 20px; border: 2px solid rgba(168, 85, 247, 0.5);">
            <div class="modal-header" style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <svg style="width: 24px; height: 24px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                    </div>
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 700; color: #ffffff; margin: 0;">Adicionar Documento Especial</h3>
                        <p style="font-size: 0.8125rem; color: rgba(255,255,255,0.6); margin: 0;">Termo de Credenciamento - Nova versão</p>
                    </div>
                </div>
                <button onclick="closeAddSpecialDocModal()" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 36px; height: 36px; border-radius: 10px; cursor: pointer;">✕</button>
            </div>
            
            <form id="special-doc-form" onsubmit="submitSpecialDocument(event)" style="padding: 24px;">
                <div style="margin-bottom: 20px;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.875rem; font-weight: 600; display: block; margin-bottom: 8px;">
                        Status do Documento *
                    </label>
                    <select id="special-doc-status" style="width: 100%; padding: 12px; border-radius: 10px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(168, 85, 247, 0.4); color: white; font-size: 0.875rem;">
                        <option value="pdf_rpps_signed">PDF Alterado e Assinado pelo RPPS</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.875rem; font-weight: 600; display: block; margin-bottom: 8px;">
                        Arquivo PDF *
                    </label>
                    <div style="border: 2px dashed rgba(168, 85, 247, 0.4); border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.3s ease;" onclick="document.getElementById('special-doc-file').click()">
                        <svg style="width: 40px; height: 40px; stroke: #a855f7; margin-bottom: 12px;" fill="none" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                        <p id="special-doc-file-name" style="color: rgba(255,255,255,0.7); font-size: 0.875rem;">Clique para selecionar o arquivo</p>
                        <input type="file" id="special-doc-file" accept=".pdf,.doc,.docx" style="display: none;" onchange="updateSpecialDocFileName(this)">
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.875rem; font-weight: 600; display: block; margin-bottom: 8px;">
                        Observações (opcional)
                    </label>
                    <textarea id="special-doc-notes" rows="3" placeholder="Notas sobre esta versão do documento..." style="width: 100%; padding: 12px; border-radius: 10px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-size: 0.875rem; resize: vertical;"></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" onclick="closeAddSpecialDocModal()" style="padding: 12px 24px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-weight: 600; cursor: pointer;">Cancelar</button>
                    <button type="submit" style="padding: 12px 24px; border-radius: 10px; background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%); border: none; color: white; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                        Enviar Documento
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal: Enviar para Assinatura da IF -->
    <div id="sendForSignatureModal" class="modal-overlay" style="display: none; z-index: 10002;">
        <div class="modal-content" style="max-width: 500px; background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%); border-radius: 20px; border: 2px solid rgba(34, 197, 94, 0.5);">
            <div class="modal-header" style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%);">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #22c55e 0%, #10b981 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <svg style="width: 24px; height: 24px; stroke: white; fill: none;" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                    </div>
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 700; color: #ffffff; margin: 0;">Enviar para Assinatura</h3>
                        <p style="font-size: 0.8125rem; color: rgba(255,255,255,0.6); margin: 0;">Solicitar assinatura digital da IF</p>
                    </div>
                </div>
                <button onclick="closeSendForSignatureModal()" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 36px; height: 36px; border-radius: 10px; cursor: pointer;">✕</button>
            </div>
            
            <div style="padding: 24px;">
                <p style="color: rgba(255,255,255,0.8); font-size: 0.875rem; margin-bottom: 20px; line-height: 1.6;">
                    Você está prestes a enviar o Termo de Credenciamento para a Instituição Financeira assinar digitalmente.
                    Ela receberá uma notificação e poderá baixar, assinar e devolver o documento.
                </p>
                
                <div style="margin-bottom: 20px;">
                    <label style="color: rgba(255,255,255,0.8); font-size: 0.875rem; font-weight: 600; display: block; margin-bottom: 8px;">
                        Mensagem para a IF (opcional)
                    </label>
                    <textarea id="signature-request-message" rows="3" placeholder="Ex: Por favor, assine o documento e retorne em até 5 dias úteis..." style="width: 100%; padding: 12px; border-radius: 10px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.2); color: white; font-size: 0.875rem; resize: vertical;"></textarea>
                </div>
                
                <input type="hidden" id="signature-doc-id" value="">
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeSendForSignatureModal()" style="padding: 12px 24px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-weight: 600; cursor: pointer;">Cancelar</button>
                    <button onclick="confirmSendForSignature()" style="padding: 12px 24px; border-radius: 10px; background: linear-gradient(135deg, #22c55e 0%, #10b981 100%); border: none; color: white; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        <svg style="width: 16px; height: 16px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                        Enviar para IF
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Estilo das Tabs -->
    <style>
        .process-tab {
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .process-tab:hover {
            color: rgba(255,255,255,0.8) !important;
            background: rgba(255,255,255,0.05);
        }
        .process-tab.active {
            color: #60a5fa !important;
            border-bottom-color: #60a5fa;
            background: rgba(96, 165, 250, 0.1);
        }
        .tab-content {
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #processModal .modal-content::-webkit-scrollbar {
            width: 6px;
        }
        #processModal .modal-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }
        #processModal .modal-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }
        
        /* Estilos para Timeline de Documentos Especiais */
        .special-timeline {
            position: relative;
            padding-left: 20px;
        }
        .special-timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #9333ea, #c084fc);
        }
        .timeline-step {
            position: relative;
            padding-bottom: 20px;
            padding-left: 25px;
        }
        .timeline-step:last-child {
            padding-bottom: 0;
        }
        .timeline-step .step-icon {
            position: absolute;
            left: -12px;
            top: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            z-index: 1;
        }
        .timeline-step .step-icon.bg-success {
            background: linear-gradient(135deg, #22c55e, #16a34a) !important;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.4);
        }
        .timeline-step .step-icon.bg-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563) !important;
        }
        .timeline-step.current .step-icon {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .timeline-step .step-content {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .timeline-step.current .step-content {
            border-color: #9333ea;
            background: rgba(147, 51, 234, 0.1);
        }
        .timeline-step .step-title {
            color: #e5e7eb;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .timeline-step.inactive .step-title {
            color: #6b7280;
        }
        .doc-item {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-top: 8px;
        }
        .doc-item .doc-name {
            color: #c084fc;
            font-weight: 500;
            flex: 1;
            min-width: 150px;
        }
        .doc-item .doc-meta {
            color: #9ca3af;
            font-size: 12px;
        }
        .doc-item .doc-actions {
            display: flex;
            gap: 5px;
        }
        .doc-item .doc-actions .btn {
            padding: 4px 8px;
            font-size: 12px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            cursor: pointer;
            color: #9ca3af;
            transition: all 0.2s ease;
        }
        .doc-item .doc-actions .btn:hover {
            background: rgba(255,255,255,0.1);
            color: #e5e7eb;
        }
        .doc-item .doc-actions .btn-outline-primary:hover {
            border-color: #3b82f6;
            color: #60a5fa;
        }
        .doc-item .doc-actions .btn-outline-info:hover {
            border-color: #22d3ee;
            color: #22d3ee;
        }
        .special-doc-actions {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Toast notification */
        .toast-notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .toast-notification.show {
            transform: translateX(0);
        }
        .toast-notification.success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        .toast-notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        .toast-notification i {
            font-size: 18px;
        }
    </style>

    <script>
        let allProcesses = [];
        let currentFilter = 'all';
        let currentProcessId = null;
        let selectedFolder = null;

        // Mapeamento de tipos para categorias
        const categoryMapping = {
            'savings_management': 'gestor',
            'investments': 'distribuidor',
            'custody': 'administrador',
            // Valores antigos (compatibilidade)
            'gestor': 'gestor',
            'distribuidor': 'distribuidor',
            'administrador': 'administrador'
        };

        // ========================================
        // FUNÇÕES DE ANIMAÇÃO PREMIUM
        // ========================================
        
        // Animação de contagem suave
        function animateCount(element, endValue, duration = 1000) {
            const startValue = parseInt(element.textContent) || 0;
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function: easeOutExpo
                const easeProgress = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);
                const currentValue = Math.round(startValue + (endValue - startValue) * easeProgress);
                
                element.textContent = currentValue;
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        // Atualizar data/hora em tempo real
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            const formatted = now.toLocaleDateString('pt-BR', options);
            const element = document.getElementById('current-datetime');
            if (element) {
                element.textContent = formatted.charAt(0).toUpperCase() + formatted.slice(1);
            }
        }

        // Iniciar atualização de data/hora
        setInterval(updateDateTime, 1000);
        updateDateTime();

        // Função para alternar visualização
        function setView(view) {
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.view-btn').classList.add('active');
            // Implementar lógica de visualização se necessário
        }

        // Carregar processos
        async function loadProcesses() {
            try {
                const response = await fetch('/api/rpps/processes');
                const data = await response.json();
                allProcesses = data;
                console.log('Processos RPPS carregados:', allProcesses);
                console.log('Exemplo de processo:', allProcesses[0]);
                updateStats();
                updateFolderCounts();
                displayProcesses(getFilteredProcesses());
            } catch (error) {
                console.error('Erro ao carregar processos:', error);
            }
        }

        // Selecionar pasta
        function selectFolder(folder) {
            selectedFolder = folder;
            
            // Definir informações da pasta
            const folderInfo = {
                'gestor': { title: 'GESTOR', description: 'Processos de Gestão de Recursos' },
                'distribuidor': { title: 'DISTRIBUIDOR', description: 'Processos de Distribuição de Valores' },
                'administrador': { title: 'ADMINISTRADOR', description: 'Processos de Administração e Custódia' }
            };
            
            document.getElementById('folder-title').textContent = folderInfo[folder].title;
            document.getElementById('folder-description').textContent = folderInfo[folder].description;
            
            // Esconder hero, status e pastas
            const heroWelcome = document.querySelector('.hero-welcome');
            const sectionHeader = document.querySelector('.section-header');
            if (heroWelcome) heroWelcome.style.display = 'none';
            if (sectionHeader) sectionHeader.style.display = 'none';
            document.getElementById('stats-section').style.display = 'none';
            document.getElementById('folders-section').style.display = 'none';
            
            // Mostrar conteúdo da pasta
            document.getElementById('folder-content').style.display = 'block';
            
            // Marcar card como ativo
            document.querySelectorAll('.category-card').forEach(card => card.classList.remove('active'));
            const activeCard = document.getElementById('folder-' + folder);
            if (activeCard) activeCard.classList.add('active');
            
            updateStats();
            displayProcesses(getFilteredProcesses());
        }
        
        // Voltar para a tela de pastas
        function voltarParaPastas() {
            selectedFolder = null;
            
            // Mostrar hero, status e pastas
            const heroWelcome = document.querySelector('.hero-welcome');
            const sectionHeader = document.querySelector('.section-header');
            if (heroWelcome) heroWelcome.style.display = 'flex';
            if (sectionHeader) sectionHeader.style.display = 'flex';
            document.getElementById('stats-section').style.display = 'grid';
            document.getElementById('folders-section').style.display = 'grid';
            
            // Esconder conteúdo
            document.getElementById('folder-content').style.display = 'none';
            
            // Remover classe ativa
            document.querySelectorAll('.category-card').forEach(card => card.classList.remove('active'));
            
            // Resetar filtro
            currentFilter = 'all';
            updateStats();
            displayProcesses(getFilteredProcesses());
        }

        // Obter processos filtrados
        function getFilteredProcesses() {
            let filtered = allProcesses;
            
            // Filtro por pasta
            if (selectedFolder) {
                filtered = filtered.filter(p => categoryMapping[p.credentialing_type] === selectedFolder);
            }
            
            // Filtro por status
            if (currentFilter !== 'all') {
                filtered = filtered.filter(p => p.status === currentFilter);
            }
            
            return filtered;
        }

        // Atualizar estatísticas com animação
        function updateStats() {
            const filtered = selectedFolder ? 
                allProcesses.filter(p => categoryMapping[p.credentialing_type] === selectedFolder) : 
                allProcesses;
            
            const total = filtered.length;
            const inReview = filtered.filter(p => p.status === 'in_review' || p.status === 'submitted').length;
            const approved = filtered.filter(p => p.status === 'approved').length;
            const returned = filtered.filter(p => p.status === 'returned').length;
            
            // Animar contadores principais
            animateCount(document.getElementById('stat-total'), total);
            animateCount(document.getElementById('stat-review'), inReview);
            animateCount(document.getElementById('stat-approved'), approved);
            animateCount(document.getElementById('stat-returned'), returned);
            
            // Animar contadores do hero
            animateCount(document.getElementById('hero-total'), total);
            animateCount(document.getElementById('hero-pending'), inReview);
            animateCount(document.getElementById('hero-approved'), approved);
            
            // Atualizar barras de progresso
            if (total > 0) {
                document.getElementById('progress-analysis').style.width = `${(inReview / total) * 100}%`;
                document.getElementById('progress-approved').style.width = `${(approved / total) * 100}%`;
                document.getElementById('progress-returned').style.width = `${(returned / total) * 100}%`;
            }
        }

        // Atualizar contadores das pastas com pendentes
        function updateFolderCounts() {
            console.log('Atualizando contadores RPPS...');
            
            const gestorProcesses = allProcesses.filter(p => categoryMapping[p.credentialing_type] === 'gestor');
            const distribuidorProcesses = allProcesses.filter(p => categoryMapping[p.credentialing_type] === 'distribuidor');
            const administradorProcesses = allProcesses.filter(p => categoryMapping[p.credentialing_type] === 'administrador');
            
            // Contagem total por categoria
            document.getElementById('badge-gestor').textContent = gestorProcesses.length;
            document.getElementById('badge-distribuidor').textContent = distribuidorProcesses.length;
            document.getElementById('badge-administrador').textContent = administradorProcesses.length;
            
            // Contagem de pendentes por categoria
            const gestorPending = gestorProcesses.filter(p => p.status === 'in_review' || p.status === 'submitted').length;
            const distribuidorPending = distribuidorProcesses.filter(p => p.status === 'in_review' || p.status === 'submitted').length;
            const administradorPending = administradorProcesses.filter(p => p.status === 'in_review' || p.status === 'submitted').length;
            
            document.getElementById('gestor-pending').textContent = gestorPending;
            document.getElementById('distribuidor-pending').textContent = distribuidorPending;
            document.getElementById('administrador-pending').textContent = administradorPending;
        }

        // Exibir processos
        function displayProcesses(processes) {
            const tbody = document.getElementById('processes-table-body');
            
            if (processes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 48px; color: #71717a;">
                            Nenhum Processo Encontrado
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = processes.map(process => `
                <tr>
                    <td><strong>#${process.custom_id || process.id}</strong></td>
                    <td>${process.financial_institution_name}</td>
                    <td>${getCategoryLabel(categoryMapping[process.credentialing_type])}</td>
                    <td>${getStatusBadge(process.status)}</td>
                    <td>
                        <span class="badge">${process.document_count || 0} Docs</span>
                    </td>
                    <td>${formatDate(process.created_at)}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="openProcessModal(${process.id})">
                            Ver Detalhes
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Filtrar processos
        function filterProcesses(status) {
            currentFilter = status;
            
            // Atualizar botões - usar nova classe filter-btn
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('filter-' + status).classList.add('active');
            
            displayProcesses(getFilteredProcesses());
        }

        // Buscar processos
        function searchProcesses(query) {
            query = query.toLowerCase();
            const filtered = getFilteredProcesses().filter(p => 
                p.financial_institution_name.toLowerCase().includes(query) ||
                p.id.toString().includes(query) ||
                getCredentialingTypeLabel(p.credentialing_type).toLowerCase().includes(query)
            );
            displayProcesses(filtered);
        }

        // Função para alternar entre as tabs do modal de processo
        function switchProcessTab(tabName) {
            // Remover classe active de todas as tabs
            document.querySelectorAll('.process-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.color = 'rgba(255,255,255,0.5)';
            });
            
            // Ocultar todo o conteúdo das tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Ativar a tab clicada
            const activeTab = document.querySelector(`.process-tab[data-tab="${tabName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.style.color = '#60a5fa';
            }
            
            // Mostrar o conteúdo correspondente
            const activeContent = document.getElementById(`tab-${tabName}`);
            if (activeContent) {
                activeContent.style.display = 'block';
            }
            
            // Inicializar assinador quando a aba for aberta
            if (tabName === 'signer') {
                initSigner();
            }
        }

        // Abrir modal de processo
        async function openProcessModal(processId) {
            currentProcessId = processId;
            const process = allProcesses.find(p => p.id === processId);
            
            // Resetar para a tab de documentos
            switchProcessTab('documents');
            
            document.getElementById('modal-process-id').textContent = process.custom_id || process.id;
            document.getElementById('modal-process-institution').textContent = process.financial_institution_name;
            document.getElementById('modal-status-badge').innerHTML = getStatusBadge(process.status);
            document.getElementById('modal-category').textContent = getCredentialingTypeLabel(process.credentialing_type);
            document.getElementById('modal-created-at').textContent = formatDate(process.created_at);
            
            // Resetar botão "Ver Relatório" e status
            const btnRelatorio = document.getElementById('btn-ver-relatorio');
            if (btnRelatorio) btnRelatorio.style.display = 'none';
            const statusDiv = document.getElementById('ai-status-message');
            if (statusDiv) statusDiv.innerHTML = '';
            
            document.getElementById('processModal').style.display = 'flex';
            
            // Carregar documentos e comunicações
            await loadDocuments(processId);
            await loadCommunications(processId);
            
            // Carregar histórico do processo
            await loadProcessHistory(processId);
            
            // Carregar documentos especiais (termo de credenciamento)
            await loadSpecialDocuments(processId);
            
            // Verificar se já existe análise de IA para este processo
            await checkExistingAnalysis(processId);
        }
        
        // Verificar se já existe análise
        async function checkExistingAnalysis(processId) {
            try {
                const response = await fetch(`/api/process/${processId}/has-analysis`);
                const result = await response.json();
                
                if (result.has_analysis) {
                    const btnRelatorio = document.getElementById('btn-ver-relatorio');
                    if (btnRelatorio) {
                        btnRelatorio.style.display = 'inline-flex';
                    }
                    const statusDiv = document.getElementById('ai-status-message');
                    if (statusDiv) {
                        statusDiv.innerHTML = '<span style="color: #22c55e;">✅ Este processo já foi analisado pela IA.</span>';
                    }
                }
            } catch (error) {
                console.log('Não foi possível verificar análise existente');
            }
        }

        // Fechar modal
        function closeModal() {
            document.getElementById('processModal').style.display = 'none';
            currentProcessId = null;
        }

        // Carregar documentos
        async function loadDocuments(processId) {
            try {
                const response = await fetch(`/api/process/${processId}/documents`);
                const documents = await response.json();
                
                const container = document.getElementById('modal-documents');
                if (documents.length === 0) {
                    container.innerHTML = '<p style="color: rgba(255, 255, 255, 0.5); text-align: center; padding: 24px;">Nenhum Documento Enviado</p>';
                    // Esconder botão ZIP quando não há docs
                    const zipBtn = document.getElementById('btn-download-zip');
                    if (zipBtn) zipBtn.style.display = 'none';
                    return;
                }
                
                // Mostrar botão ZIP quando há docs
                const zipBtn = document.getElementById('btn-download-zip');
                if (zipBtn) zipBtn.style.display = 'inline-flex';
                
                container.innerHTML = documents.map(doc => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(30, 41, 59, 0.6); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s;" 
                         onclick="previewDocument('/uploads/${doc.filename}', '${doc.name.replace(/'/g, "\\'")}')"
                         onmouseover="this.style.background='rgba(59, 130, 246, 0.15)'; this.style.borderColor='rgba(59, 130, 246, 0.3)'"
                         onmouseout="this.style.background='rgba(30, 41, 59, 0.6)'; this.style.borderColor='rgba(255, 255, 255, 0.1)'">
                        <div style="flex: 1; display: flex; align-items: center; gap: 10px;">
                            <svg style="width: 20px; height: 20px; stroke: #60a5fa; fill: none;" viewBox="0 0 24 24"><path d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                            <div>
                                <div style="font-weight: 600; color: #ffffff;">${doc.name}</div>
                                <div style="font-size: 0.8125rem; color: rgba(255, 255, 255, 0.5);">${formatDate(doc.uploaded_at)} • Clique para visualizar</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;" onclick="event.stopPropagation();">
                            <a href="/uploads/${doc.filename}" target="_blank" class="btn btn-sm btn-secondary" style="display: inline-flex; align-items: center; gap: 4px; background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3);" title="Baixar documento">
                                <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                            </a>
                            <button class="btn btn-sm btn-danger" onclick="removeDocument(${processId}, ${doc.id})" style="display: inline-flex; align-items: center; gap: 4px; background: rgba(220, 38, 38, 0.2); color: #f87171; border: 1px solid rgba(220, 38, 38, 0.3);" title="Remover documento">
                                <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                            </button>
                        </div>
                    </div>
                `).join('');
                
                // Atualizar badge de contagem de documentos
                const docCountBadge = document.getElementById('doc-count-badge');
                if (docCountBadge) {
                    docCountBadge.textContent = documents.length;
                }
            } catch (error) {
                console.error('Erro ao carregar documentos:', error);
            }
        }

        // Carregar comunicações
        async function loadCommunications(processId) {
            try {
                const response = await fetch(`/api/process/${processId}/communications`);
                const allCommunications = await response.json();
                
                // Filtrar apenas mensagens humanas (excluir análises de IA e mensagens automáticas do sistema)
                const communications = allCommunications.filter(comm => {
                    // Remover mensagens de análise com IA
                    if (comm.message && comm.message.includes('**Análise')) return false;
                    if (comm.message && comm.message.includes('Análise com IA')) return false;
                    if (comm.message && comm.message.includes('**Score:**')) return false;
                    if (comm.sender_name === 'Sistema' && comm.message_type !== 'comment') return false;
                    
                    // Manter apenas comunicações reais entre IF e RPPS
                    return comm.message_type === 'comment' || comm.message_type === 'message';
                });
                
                const container = document.getElementById('communications-list');
                if (communications.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #71717a; padding: 24px;">Nenhuma Comunicação Ainda</p>';
                    return;
                }
                
                container.innerHTML = communications.map(comm => {
                    let cssClass = 'communication-item';
                    if (comm.message_type === 'system') cssClass += ' system';
                    else if (comm.sender_role === 'rpps') cssClass += ' from-rpps';
                    else if (comm.sender_role === 'financial_institution') cssClass += ' from-if';
                    
                    return `
                        <div class="${cssClass}">
                            <div class="communication-meta">
                                <span class="communication-author">${comm.sender_name} ${getRoleIcon(comm.sender_role)}</span>
                                <span class="communication-time">${formatDateTime(comm.created_at)}</span>
                            </div>
                            <div class="communication-message">${comm.message}</div>
                        </div>
                    `;
                }).join('');
                
                // Atualizar badge de contagem de mensagens
                const msgCountBadge = document.getElementById('msg-count-badge');
                if (msgCountBadge && communications.length > 0) {
                    msgCountBadge.textContent = communications.length;
                    msgCountBadge.style.display = 'inline';
                }
                
                // Scroll para o final
                container.scrollTop = container.scrollHeight;
            } catch (error) {
                console.error('Erro ao carregar comunicações:', error);
            }
        }
        
        // Carregar histórico do processo (timeline)
        async function loadProcessHistory(processId) {
            const timeline = document.getElementById('history-timeline');
            
            try {
                const response = await fetch(`/api/process/${processId}/history`);
                const data = await response.json();
                
                if (data.history && data.history.length > 0) {
                    timeline.innerHTML = data.history.map((item, index) => {
                        const iconInfo = getHistoryIcon(item.action);
                        const isLast = index === data.history.length - 1;
                        
                        return `
                            <div style="position: relative; padding-bottom: ${isLast ? '0' : '24px'};">
                                <!-- Linha conectora -->
                                ${!isLast ? `<div style="position: absolute; left: -28px; top: 24px; bottom: 0; width: 2px; background: linear-gradient(180deg, ${iconInfo.color} 0%, rgba(255,255,255,0.1) 100%);"></div>` : ''}
                                
                                <!-- Ícone -->
                                <div style="position: absolute; left: -36px; top: 0; width: 24px; height: 24px; background: ${iconInfo.bg}; border: 2px solid ${iconInfo.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    ${iconInfo.icon}
                                </div>
                                
                                <!-- Conteúdo -->
                                <div style="background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 14px 18px; margin-left: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px;">
                                        <span style="font-weight: 700; color: ${iconInfo.color}; font-size: 0.875rem;">${item.action}</span>
                                        <span style="color: rgba(255,255,255,0.4); font-size: 0.75rem;">${formatHistoryDateTime(item.created_at)}</span>
                                    </div>
                                    ${item.details ? `<p style="color: rgba(255,255,255,0.7); font-size: 0.8125rem; margin: 0; line-height: 1.5;">${item.details}</p>` : ''}
                                    <p style="color: rgba(255,255,255,0.4); font-size: 0.75rem; margin-top: 6px;">
                                        <span style="color: ${item.user_role === 'rpps' ? '#60a5fa' : '#fbbf24'};">
                                            ${item.user_role === 'rpps' ? '🏛️ RPPS' : '🏦 IF'}
                                        </span>
                                        • ${item.user_name || 'Sistema'}
                                    </p>
                                </div>
                            </div>
                        `;
                    }).join('');
                } else {
                    timeline.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <svg style="width: 48px; height: 48px; stroke: rgba(255,255,255,0.3); margin-bottom: 12px;" fill="none" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <p style="color: rgba(255,255,255,0.5); font-size: 0.875rem;">Nenhum histórico registrado ainda</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar histórico:', error);
                timeline.innerHTML = `<p style="color: #f87171; text-align: center; padding: 24px;">Erro ao carregar histórico</p>`;
            }
        }
        
        // Helper para obter ícone e cor baseado na ação
        function getHistoryIcon(action) {
            const actionLower = action.toLowerCase();
            
            if (actionLower.includes('criado') || actionLower.includes('cadastrado')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #22d3ee; fill: none;" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>',
                    color: '#22d3ee',
                    bg: 'rgba(34, 211, 238, 0.2)'
                };
            } else if (actionLower.includes('enviado') || actionLower.includes('submet')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #60a5fa; fill: none;" viewBox="0 0 24 24"><path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>',
                    color: '#60a5fa',
                    bg: 'rgba(96, 165, 250, 0.2)'
                };
            } else if (actionLower.includes('análise') || actionLower.includes('analis')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #a78bfa; fill: none;" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>',
                    color: '#a78bfa',
                    bg: 'rgba(167, 139, 250, 0.2)'
                };
            } else if (actionLower.includes('devolvido') || actionLower.includes('devolu')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #fbbf24; fill: none;" viewBox="0 0 24 24"><path d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg>',
                    color: '#fbbf24',
                    bg: 'rgba(251, 191, 36, 0.2)'
                };
            } else if (actionLower.includes('aprovado') || actionLower.includes('conclu')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #22c55e; fill: none;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>',
                    color: '#22c55e',
                    bg: 'rgba(34, 197, 94, 0.2)'
                };
            } else if (actionLower.includes('rejeitado') || actionLower.includes('recusa')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #ef4444; fill: none;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>',
                    color: '#ef4444',
                    bg: 'rgba(239, 68, 68, 0.2)'
                };
            } else if (actionLower.includes('documento')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #10b981; fill: none;" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>',
                    color: '#10b981',
                    bg: 'rgba(16, 185, 129, 0.2)'
                };
            } else if (actionLower.includes('ia') || actionLower.includes('inteligência')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #f472b6; fill: none;" viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>',
                    color: '#f472b6',
                    bg: 'rgba(244, 114, 182, 0.2)'
                };
            } else if (actionLower.includes('solicit')) {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #fb923c; fill: none;" viewBox="0 0 24 24"><path d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
                    color: '#fb923c',
                    bg: 'rgba(251, 146, 60, 0.2)'
                };
            } else {
                return {
                    icon: '<svg style="width: 12px; height: 12px; stroke: #94a3b8; fill: none;" viewBox="0 0 24 24"><path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
                    color: '#94a3b8',
                    bg: 'rgba(148, 163, 184, 0.2)'
                };
            }
        }
        
        // Formatar data e hora para histórico
        function formatHistoryDateTime(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('pt-BR') + ' às ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        // =============== FUNÇÕES DE DOCUMENTOS ESPECIAIS ===============
        
        let currentSpecialDocForSignature = null;
        
        // Carregar documentos especiais
        async function loadSpecialDocuments(processId) {
            const container = document.getElementById('special-docs-timeline');
            const tabBtn = document.getElementById('tab-btn-termo');
            const termoBadge = document.getElementById('termo-count-badge');
            if (!container) return;
            
            container.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 24px;">Carregando...</p>';
            
            try {
                const response = await fetch(`/api/process/${processId}/special-documents`);
                
                if (!response.ok) {
                    if (tabBtn) tabBtn.style.display = 'none';
                    return;
                }
                
                const data = await response.json();
                
                if (!data.documents || data.documents.length === 0) {
                    if (tabBtn) tabBtn.style.display = 'none';
                    return;
                }
                
                // Mostrar aba Termo quando há documentos especiais
                if (tabBtn) tabBtn.style.display = 'flex';
                if (termoBadge) termoBadge.textContent = data.documents.length;
                
                renderSpecialDocTimeline(data.documents, data.current_status);
            } catch (error) {
                console.error('Erro ao carregar documentos especiais:', error);
                if (tabBtn) tabBtn.style.display = 'none';
            }
        }
        
        // Renderizar timeline de documentos especiais
        function renderSpecialDocTimeline(documents, currentStatus) {
            const container = document.getElementById('special-docs-timeline');
            if (!container) return;
            
            // Status em ordem do fluxo
            const statusOrder = ['excel_if', 'pdf_rpps_signed', 'awaiting_if_signature', 'signed_by_if', 'official_final'];
            const statusLabels = {
                'excel_if': 'Excel Enviado pela IF',
                'pdf_rpps_signed': 'PDF Assinado pelo RPPS',
                'awaiting_if_signature': 'Aguardando Assinatura IF',
                'signed_by_if': 'Assinado pela IF',
                'official_final': 'Documento Oficial Final'
            };
            const statusIcons = {
                'excel_if': '<svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 17V7l8 5-8 5z"/></svg>',
                'pdf_rpps_signed': '<svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>',
                'awaiting_if_signature': '<svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
                'signed_by_if': '<svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
                'official_final': '<svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>'
            };
            
            let html = '<div class="special-timeline">';
            
            // Agrupar documentos por status
            const docsByStatus = {};
            documents.forEach(doc => {
                if (!docsByStatus[doc.status]) docsByStatus[doc.status] = [];
                docsByStatus[doc.status].push(doc);
            });
            
            // Mostrar documentos na ordem do fluxo
            statusOrder.forEach((status, index) => {
                const docs = docsByStatus[status] || [];
                const isActive = docs.length > 0;
                const isCurrent = status === currentStatus;
                
                if (isActive || (statusOrder.indexOf(currentStatus) >= index)) {
                    html += `
                        <div class="timeline-step ${isActive ? 'active' : 'inactive'} ${isCurrent ? 'current' : ''}">
                            <div class="step-icon ${isActive ? 'bg-success' : 'bg-secondary'}">
                                ${statusIcons[status]}
                            </div>
                            <div class="step-content">
                                <h6 class="step-title">${statusLabels[status]}</h6>
                    `;
                    
                    if (docs.length > 0) {
                        docs.forEach(doc => {
                            html += `
                                <div class="doc-item">
                                    <span class="doc-name">${doc.original_filename}</span>
                                    <span class="doc-meta">v${doc.version} • ${formatHistoryDateTime(doc.created_at)}</span>
                                    <div class="doc-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="downloadSpecialDoc(${doc.id})" title="Baixar">
                                            <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info" onclick="previewSpecialDoc(${doc.id}, '${doc.mime_type}')" title="Visualizar">
                                            <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                                        </button>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    html += '</div></div>';
                }
            });
            
            html += '</div>';
            
            // Botões de ação baseados no status atual
            html += '<div class="special-doc-actions mt-3">';
            
            if (currentStatus === 'excel_if') {
                html += `
                    <button class="btn btn-primary" onclick="openAddSpecialDocModal()" style="background: linear-gradient(135deg, #9333ea, #7c3aed); border: none; padding: 12px 24px; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                        <svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        Adicionar PDF Assinado
                    </button>
                    <small style="color: rgba(255,255,255,0.5); display: block; margin-top: 8px;">Baixe o Excel, preencha, converta para PDF, assine e adicione aqui.</small>
                `;
            } else if (currentStatus === 'pdf_rpps_signed') {
                html += `
                    <button class="btn btn-warning" onclick="openSendForSignatureModal()" style="background: linear-gradient(135deg, #f59e0b, #d97706); border: none; padding: 12px 24px; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                        <svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                        Enviar para IF Assinar
                    </button>
                    <small style="color: rgba(255,255,255,0.5); display: block; margin-top: 8px;">Envie o termo assinado para que a IF também assine.</small>
                `;
            } else if (currentStatus === 'awaiting_if_signature') {
                html += `
                    <div style="background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; border-radius: 10px; padding: 14px; color: #60a5fa; display: flex; align-items: center; gap: 10px;">
                        <svg style="width: 20px; height: 20px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        Aguardando a IF assinar e devolver o termo.
                    </div>
                `;
            } else if (currentStatus === 'signed_by_if') {
                const signedDoc = docsByStatus['signed_by_if'] ? docsByStatus['signed_by_if'][0] : null;
                if (signedDoc) {
                    html += `
                        <button class="btn btn-success" onclick="finalizeSpecialDocument(${signedDoc.id})" style="background: linear-gradient(135deg, #22c55e, #16a34a); border: none; padding: 12px 24px; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                            <svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            Finalizar e Juntar ao Dossiê
                        </button>
                        <small style="color: rgba(255,255,255,0.5); display: block; margin-top: 8px;">Ao finalizar, este termo se tornará o documento oficial do processo.</small>
                    `;
                }
            } else if (currentStatus === 'official_final') {
                html += `
                    <div style="background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; border-radius: 10px; padding: 14px; color: #22c55e; display: flex; align-items: center; gap: 10px;">
                        <svg style="width: 20px; height: 20px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        Termo de Credenciamento finalizado e juntado ao dossiê oficial.
                    </div>
                `;
            }
            
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        // Baixar documento especial
        function downloadSpecialDoc(docId) {
            window.open(`/api/special-document/${docId}/download`, '_blank');
        }
        
        // Visualizar documento especial
        function previewSpecialDoc(docId, mimeType) {
            const url = `/api/special-document/${docId}/download`;
            if (mimeType && mimeType.includes('pdf')) {
                window.open(url, '_blank');
            } else {
                window.open(url, '_blank');
            }
        }
        
        // Abrir modal para adicionar documento especial
        function openAddSpecialDocModal() {
            document.getElementById('addSpecialDocModal').style.display = 'flex';
            document.getElementById('special-doc-file').value = '';
            document.getElementById('special-doc-file-name').textContent = 'Nenhum arquivo selecionado';
            document.getElementById('special-doc-notes').value = '';
        }
        
        // Fechar modal de adicionar documento especial
        function closeAddSpecialDocModal() {
            document.getElementById('addSpecialDocModal').style.display = 'none';
        }
        
        // Atualizar nome do arquivo selecionado
        function updateSpecialDocFileName(input) {
            const fileName = input.files.length > 0 ? input.files[0].name : 'Nenhum arquivo selecionado';
            document.getElementById('special-doc-file-name').textContent = fileName;
        }
        
        // Enviar documento especial
        async function submitSpecialDocument(event) {
            event.preventDefault();
            
            const fileInput = document.getElementById('special-doc-file');
            const notes = document.getElementById('special-doc-notes').value;
            
            if (!fileInput.files.length) {
                alert('Por favor, selecione um arquivo PDF');
                return;
            }
            
            const file = fileInput.files[0];
            if (!file.name.toLowerCase().endsWith('.pdf')) {
                alert('Por favor, selecione um arquivo PDF');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('document_type', 'termo_credenciamento');
            formData.append('status', 'pdf_rpps_signed');
            formData.append('notes', notes);
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/special-document`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    closeAddSpecialDocModal();
                    await loadSpecialDocuments(currentProcessId);
                    showToast('success', 'PDF assinado adicionado com sucesso!');
                } else {
                    alert(result.error || 'Erro ao adicionar documento');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao enviar documento');
            }
        }
        
        // Abrir modal para enviar para assinatura
        function openSendForSignatureModal() {
            document.getElementById('sendForSignatureModal').style.display = 'flex';
            document.getElementById('signature-request-message').value = 'Encaminho o Termo de Credenciamento assinado para sua análise e assinatura.';
        }
        
        // Fechar modal de enviar para assinatura
        function closeSendForSignatureModal() {
            document.getElementById('sendForSignatureModal').style.display = 'none';
        }
        
        // Confirmar envio para assinatura
        async function confirmSendForSignature() {
            const message = document.getElementById('signature-request-message').value;
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/send-term-for-signature`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ message })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    closeSendForSignatureModal();
                    await loadSpecialDocuments(currentProcessId);
                    showToast('success', 'Termo enviado para assinatura da IF!');
                } else {
                    alert(result.error || 'Erro ao enviar para assinatura');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao enviar para assinatura');
            }
        }
        
        // Finalizar documento especial
        async function finalizeSpecialDocument(docId) {
            if (!confirm('Ao finalizar, este termo se tornará o documento oficial do processo e substituirá o termo anterior. Deseja continuar?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/finalize-term`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ special_doc_id: docId })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    await loadSpecialDocuments(currentProcessId);
                    await loadDocuments(currentProcessId);
                    showToast('success', 'Termo de Credenciamento finalizado e juntado ao dossiê!');
                } else {
                    alert(result.error || 'Erro ao finalizar termo');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao finalizar termo');
            }
        }
        
        // Toast notification
        function showToast(type, message) {
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            const icon = type === 'success' 
                ? '<svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
                : '<svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            toast.innerHTML = `${icon}<span>${message}</span>`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // =============== FIM DAS FUNÇÕES DE DOCUMENTOS ESPECIAIS ===============

        // Enviar mensagem
        async function sendMessage() {
            const input = document.getElementById('new-message-input');
            const message = input.value.trim();
            
            if (!message) {
                alert('Por Favor, Digite uma Mensagem');
                return;
            }
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/communications`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({message, message_type: 'comment'})
                });
                
                if (response.ok) {
                    input.value = '';
                    await loadCommunications(currentProcessId);
                }
            } catch (error) {
                console.error('Erro ao enviar mensagem:', error);
                alert('Erro ao Enviar Mensagem');
            }
        }

        // Mudar status
        async function changeStatus(newStatus, reasonParam = null) {
            // Se o motivo não foi passado, pedir ao usuário
            let reason = reasonParam;
            if (reason === null) {
                reason = prompt('Motivo da Mudança de Status (Opcional):');
                if (reason === null) return;  // Usuário cancelou
            }
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/change-status`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({status: newStatus, reason})
                });
                
                if (response.ok) {
                    showNotification('Status atualizado com sucesso!', 'success');
                    await loadCommunications(currentProcessId);
                    await loadProcesses();
                    closeModal();
                }
            } catch (error) {
                console.error('Erro ao mudar status:', error);
                showNotification('Erro ao mudar status', 'error');
            }
        }

        // Ver relatório completo de análise com IA
        function viewAnalysisReport() {
            if (!currentProcessId) {
                alert('❌ Nenhum processo selecionado');
                return;
            }
            
            // Abrir relatório em nova aba
            window.open(`/analysis-report?process_id=${currentProcessId}`, '_blank');
        }

        // Iniciar análise com IA (processamento rápido)
        async function startAIAnalysis() {
            if (!confirm('Deseja processar este processo com IA? Isso irá analisar todos os documentos rapidamente.')) {
                return;
            }
            
            // Mostrar status de processamento
            const statusDiv = document.getElementById('ai-status-message');
            if (statusDiv) {
                statusDiv.innerHTML = '<span style="color: #22d3ee;">⏳ Processando documentos com IA...</span>';
            }
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/analyze`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showNotification('✅ ' + result.message, 'success');
                    
                    // Mostrar botão "Ver Relatório" após processamento bem-sucedido
                    const btnRelatorio = document.getElementById('btn-ver-relatorio');
                    if (btnRelatorio) {
                        btnRelatorio.style.display = 'inline-flex';
                    }
                    
                    // Atualizar status
                    if (statusDiv) {
                        statusDiv.innerHTML = '<span style="color: #22c55e;">✅ Análise concluída! Clique em "Ver Relatório" para detalhes.</span>';
                    }
                    
                    await loadCommunications(currentProcessId);
                    await loadProcesses();
                } else {
                    showNotification('❌ Erro: ' + (result.error || 'Não foi possível iniciar a análise'), 'error');
                    if (statusDiv) {
                        statusDiv.innerHTML = '<span style="color: #ef4444;">❌ ' + (result.error || 'Erro na análise') + '</span>';
                    }
                }
            } catch (error) {
                console.error('Erro ao iniciar análise:', error);
                showNotification('❌ Erro ao iniciar análise com IA', 'error');
                if (statusDiv) {
                    statusDiv.innerHTML = '<span style="color: #ef4444;">❌ Erro na conexão</span>';
                }
            }
        }

        // ========== MODAIS DE DEVOLUÇÃO E SOLICITAÇÃO ==========
        
        // Abrir modal de devolução
        function openReturnModal() {
            document.getElementById('returnModal').style.display = 'flex';
            document.getElementById('return-reason').value = '';
            loadDocumentsForReturn();
        }
        
        // Fechar modal de devolução
        function closeReturnModal() {
            document.getElementById('returnModal').style.display = 'none';
        }
        
        // Carregar documentos no modal de devolução
        async function loadDocumentsForReturn() {
            const container = document.getElementById('return-docs-list');
            if (!currentProcessId) return;
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/documents`);
                const documents = await response.json();
                
                if (documents.length === 0) {
                    container.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; font-size: 0.8125rem;">Nenhum documento encontrado</p>';
                    return;
                }
                
                let html = '';
                documents.forEach(doc => {
                    html += `
                        <label style="display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 8px; cursor: pointer; transition: background 0.2s;" 
                               onmouseover="this.style.background='rgba(255,255,255,0.05)'" 
                               onmouseout="this.style.background='transparent'">
                            <input type="checkbox" name="return-doc" value="${doc.id}" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: rgba(255,255,255,0.9); font-size: 0.875rem;">${doc.name}</span>
                        </label>
                    `;
                });
                container.innerHTML = html;
            } catch (error) {
                console.error('Erro:', error);
                container.innerHTML = '<p style="color: #ef4444; text-align: center; font-size: 0.8125rem;">Erro ao carregar documentos</p>';
            }
        }
        
        // Enviar devolução
        async function submitReturn() {
            const reason = document.getElementById('return-reason').value.trim();
            if (!reason) {
                alert('É necessário informar o motivo da devolução');
                return;
            }
            
            const checkedDocs = Array.from(document.querySelectorAll('input[name="return-doc"]:checked'))
                                     .map(cb => cb.value);
            
            closeReturnModal();
            
            // Adiciona os docs com problema ao motivo se houver
            let fullReason = reason;
            if (checkedDocs.length > 0) {
                fullReason += `\n\n[Documentos com problema: ${checkedDocs.length}]`;
            }
            
            await changeStatus('returned', fullReason);
        }
        
        // Abrir modal de solicitar documento
        function openRequestDocModal() {
            document.getElementById('requestDocModal').style.display = 'flex';
            document.getElementById('request-doc-description').value = '';
        }
        
        // Fechar modal de solicitar documento
        function closeRequestDocModal() {
            document.getElementById('requestDocModal').style.display = 'none';
        }
        
        // Enviar solicitação de documento
        async function submitRequestDoc() {
            const description = document.getElementById('request-doc-description').value.trim();
            if (!description) {
                alert('É necessário descrever o documento que precisa ser enviado');
                return;
            }
            
            closeRequestDocModal();
            
            try {
                const response = await fetch(`/api/process/${currentProcessId}/request-document`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        document_type: 'Documento Solicitado',
                        description: description
                    })
                });
                
                if (response.ok) {
                    showNotification('Documento solicitado com sucesso!', 'success');
                    await loadCommunications(currentProcessId);
                } else {
                    showNotification('Erro ao solicitar documento', 'error');
                }
            } catch (error) {
                console.error('Erro:', error);
                showNotification('Erro ao solicitar documento', 'error');
            }
        }
        
        // ========== VISUALIZAÇÃO DE DOCUMENTO ==========
        
        function previewDocument(fileUrl, fileName) {
            document.getElementById('docPreviewModal').style.display = 'flex';
            document.getElementById('doc-preview-title').textContent = fileName;
            document.getElementById('doc-preview-download').href = fileUrl;
            document.getElementById('doc-preview-iframe').src = fileUrl;
        }
        
        function closeDocPreviewModal() {
            document.getElementById('docPreviewModal').style.display = 'none';
            document.getElementById('doc-preview-iframe').src = '';
        }
        
        // ========== DOWNLOAD ZIP ==========
        
        async function downloadAllDocumentsZip() {
            if (!currentProcessId) return;
            
            showNotification('Preparando download do ZIP...', 'success');
            
            try {
                window.location.href = `/api/process/${currentProcessId}/download-zip`;
            } catch (error) {
                console.error('Erro:', error);
                showNotification('Erro ao baixar ZIP', 'error');
            }
        }

        // Devolver processo (backup - mantido por compatibilidade)
        function returnProcess() {
            openReturnModal();
        }

        // Solicitar documento (backup - mantido por compatibilidade)
        function requestDocument() {
            openRequestDocModal();
        }

        // Aprovar processo
        function approveProcess() {
            if (!confirm('Tem Certeza que Deseja APROVAR este Credenciamento?')) return;
            changeStatus('approved');
        }

        // Rejeitar processo
        function rejectProcess() {
            if (!confirm('Tem Certeza que Deseja REJEITAR este Credenciamento?')) return;
            const reason = prompt('Motivo da Rejeição:');
            if (!reason) {
                alert('É Necessário Informar o Motivo da Rejeição');
                return;
            }
            changeStatus('rejected');
        }

        // Remover documento
        async function removeDocument(processId, documentId) {
            if (!confirm('Tem Certeza que Deseja Remover este Documento?\n\nEsta ação não pode ser desfeita.')) return;
            
            try {
                const response = await fetch(`/api/delete-document/${documentId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showNotification('Documento removido com sucesso!', 'success');
                    await loadDocuments(processId);
                    await loadCommunications(processId);
                } else {
                    showNotification(result.error || 'Erro ao remover documento', 'error');
                }
            } catch (error) {
                console.error('Erro:', error);
                showNotification('Erro ao remover documento', 'error');
            }
        }

        // Helpers
        function getStatusBadge(status) {
            const labels = {
                'draft': 'Rascunho',
                'submitted': 'Enviado',
                'in_review': 'Em Análise',
                'returned': 'Devolvido',
                'approved': 'Aprovado',
                'rejected': 'Rejeitado'
            };
            return `<span class="badge-status badge-${status}">${labels[status] || status}</span>`;
        }

        function getCredentialingTypeLabel(type) {
            const labels = {
                'savings_management': 'Gestor',
                'investments': 'Distribuidor',
                'custody': 'Administrador'
            };
            return labels[type] || type;
        }

        function getCategoryLabel(category) {
            const labels = {
                'gestor': 'Gestor',
                'distribuidor': 'Distribuidor',
                'administrador': 'Administrador'
            };
            return labels[category] || category;
        }

        function getCredentialingTypeLabel(type) {
            const labels = {
                'savings_management': 'Gestor',
                'investments': 'Distribuidor',
                'custody': 'Administrador'
            };
            return labels[type] || type;
        }

        function getRoleIcon(role) {
            if (role === 'rpps') {
                return '<svg style="display:inline-block;width:16px;height:16px;vertical-align:middle;margin-left:4px" fill="none" stroke="#60a5fa" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0012 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75z"/></svg>';
            }
            return '<svg style="display:inline-block;width:16px;height:16px;vertical-align:middle;margin-left:4px" fill="none" stroke="#22d3ee" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z"/></svg>';
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('pt-BR');
        }

        function logout() {
            window.location.href = '/logout';
        }

        // ========== ASSINADOR DIGITAL ==========
        
        let selectedCertType = 'a3';
        let a1CertFile = null;
        let a1CertValid = false;
        let fortifyAvailable = false;
        let selectedPdfFile = null;
        
        // Abrir modal do assinador
        function openAssinadorModal() {
            document.getElementById('assinadorModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            // Resetar estado
            selectedCertType = 'a3';
            a1CertFile = null;
            a1CertValid = false;
            selectedPdfFile = null;
            document.getElementById('a1-cert-file').value = '';
            document.getElementById('a1-cert-password').value = '';
            document.getElementById('a1-cert-filename').textContent = 'Clique para selecionar';
            document.getElementById('a1-cert-info').style.display = 'none';
            document.getElementById('signer-pdf-file').value = '';
            document.getElementById('pdf-filename').textContent = 'Clique para selecionar um PDF';
            selectCertType('a3');
            updateSignButtonStateModal();
            checkFortifyStatus();
        }
        
        // Fechar modal do assinador
        function closeAssinadorModal() {
            document.getElementById('assinadorModal').style.display = 'none';
            document.body.style.overflow = '';
        }
        
        // Handler para upload de PDF
        function handlePdfUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            if (!file.name.toLowerCase().endsWith('.pdf')) {
                showToast('Selecione um arquivo PDF', 'error');
                input.value = '';
                return;
            }
            
            selectedPdfFile = file;
            document.getElementById('pdf-filename').textContent = file.name;
            document.getElementById('pdf-dropzone').style.borderColor = 'rgba(16, 185, 129, 0.6)';
            updateSignButtonStateModal();
        }
        
        // Atualizar estado do botão de assinar (modal independente)
        function updateSignButtonStateModal() {
            const btn = document.getElementById('btn-sign-document');
            if (!btn) return;
            
            let canSign = false;
            
            if (selectedCertType === 'a3') {
                canSign = fortifyAvailable && selectedPdfFile;
            } else {
                canSign = a1CertValid && selectedPdfFile;
            }
            
            btn.disabled = !canSign;
            btn.style.opacity = canSign ? '1' : '0.5';
        }
        
        // Assinar documento (modal independente)
        async function signDocumentModal() {
            if (!selectedPdfFile) {
                showToast('Selecione um documento PDF', 'error');
                return;
            }
            
            const reason = document.getElementById('signer-reason').value;
            const location = document.getElementById('signer-location').value;
            const includeVisual = document.getElementById('signer-visual').checked;
            const position = document.getElementById('signer-position').value;
            
            const btn = document.getElementById('btn-sign-document');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<svg style="width: 18px; height: 18px; animation: spin 1s linear infinite;" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg> Assinando...`;
            
            try {
                if (selectedCertType === 'a3') {
                    showToast('Assinatura A3 requer Fortify. Em desenvolvimento.', 'info');
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                    return;
                }
                
                // Assinatura A1
                const formData = new FormData();
                formData.append('certificate', a1CertFile);
                formData.append('password', document.getElementById('a1-cert-password').value);
                formData.append('pdf_file', selectedPdfFile);
                formData.append('reason', reason);
                formData.append('location', location);
                formData.append('include_visual', includeVisual);
                formData.append('stamp_position', position);
                
                const response = await fetch('/api/signer/sign-a1', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedPdfFile.name.replace('.pdf', '_assinado.pdf');
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showToast('Documento assinado com sucesso!', 'success');
                    closeAssinadorModal();
                } else {
                    const error = await response.json();
                    showToast(error.error || 'Erro ao assinar documento', 'error');
                }
            } catch (error) {
                console.error('Erro:', error);
                showToast('Erro ao assinar documento', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
                updateSignButtonStateModal();
            }
        }
        
        // Selecionar tipo de certificado (A3 ou A1)
        function selectCertType(type) {
            selectedCertType = type;
            
            // Atualizar visual dos botões
            document.querySelectorAll('.cert-type-btn').forEach(btn => {
                btn.style.background = 'rgba(255, 255, 255, 0.05)';
                btn.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                btn.style.color = 'rgba(255,255,255,0.7)';
                btn.querySelector('div:first-child').style.background = 'rgba(255, 255, 255, 0.1)';
            });
            
            const activeBtn = document.getElementById(`btn-cert-${type}`);
            if (type === 'a3') {
                activeBtn.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(5, 150, 105, 0.3) 100%)';
                activeBtn.style.borderColor = '#10b981';
                activeBtn.style.color = 'white';
                activeBtn.querySelector('div:first-child').style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
            } else {
                activeBtn.style.background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(37, 99, 235, 0.3) 100%)';
                activeBtn.style.borderColor = '#3b82f6';
                activeBtn.style.color = 'white';
                activeBtn.querySelector('div:first-child').style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
            }
            
            // Mostrar/ocultar áreas
            document.getElementById('signer-area-a3').style.display = type === 'a3' ? 'block' : 'none';
            document.getElementById('signer-area-a1').style.display = type === 'a1' ? 'block' : 'none';
            
            updateSignButtonStateModal();
        }
        
        // Verificar status do Fortify (para A3)
        async function checkFortifyStatus() {
            const statusDiv = document.getElementById('fortify-status');
            const certSelector = document.getElementById('a3-cert-selector');
            
            try {
                // Tentar conectar ao Fortify (porta padrão 31337)
                const response = await fetch('https://127.0.0.1:31337/info', {
                    method: 'GET',
                    mode: 'cors',
                    headers: { 'Accept': 'application/json' }
                }).catch(() => null);
                
                if (response && response.ok) {
                    fortifyAvailable = true;
                    statusDiv.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%)';
                    statusDiv.style.borderColor = 'rgba(16, 185, 129, 0.3)';
                    statusDiv.innerHTML = `
                        <svg style="width: 20px; height: 20px; stroke: #10b981; fill: none; flex-shrink: 0;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <div>
                            <div style="color: #10b981; font-weight: 700; font-size: 0.875rem;">Fortify conectado</div>
                            <div style="color: rgba(255,255,255,0.6); font-size: 0.75rem;">Pronto para usar certificados A3</div>
                        </div>
                    `;
                    
                    // Tentar listar certificados
                    loadA3Certificates();
                } else {
                    throw new Error('Fortify não responde');
                }
            } catch (error) {
                fortifyAvailable = false;
                statusDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                statusDiv.style.borderColor = 'rgba(239, 68, 68, 0.3)';
                statusDiv.innerHTML = `
                    <svg style="width: 20px; height: 20px; stroke: #ef4444; fill: none; flex-shrink: 0;" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                    <div>
                        <div style="color: #ef4444; font-weight: 700; font-size: 0.875rem;">Fortify não detectado</div>
                        <div style="color: rgba(255,255,255,0.6); font-size: 0.75rem;">Instale o <a href="https://fortifyapp.com/" target="_blank" style="color: #22d3ee;">Fortify</a> e recarregue a página</div>
                    </div>
                    <button onclick="checkFortifyStatus()" style="margin-left: auto; padding: 8px 16px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-size: 0.75rem; cursor: pointer;">Verificar</button>
                `;
                certSelector.style.display = 'none';
            }
            
            updateSignButtonStateModal();
        }
        
        // Carregar certificados A3 do Fortify
        async function loadA3Certificates() {
            const certSelector = document.getElementById('a3-cert-selector');
            const certList = document.getElementById('a3-cert-list');
            
            try {
                // Isso seria implementado com a API do Fortify
                // Por enquanto, mostrar que está pronto
                certSelector.style.display = 'block';
                certList.innerHTML = '<option value="">Token/Smartcard detectado - Digite o PIN ao assinar</option>';
            } catch (error) {
                console.error('Erro ao carregar certificados A3:', error);
            }
        }
        
        // Handler para upload do certificado A1
        function handleA1CertUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            a1CertFile = file;
            document.getElementById('a1-cert-filename').textContent = file.name;
            document.getElementById('a1-cert-dropzone').style.borderColor = 'rgba(16, 185, 129, 0.6)';
            
            // Limpar info anterior
            document.getElementById('a1-cert-info').style.display = 'none';
            a1CertValid = false;
            updateSignButtonStateModal();
        }
        
        // Validar certificado A1 (quando informar a senha)
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('a1-cert-password');
            if (passwordInput) {
                let debounceTimer;
                passwordInput.addEventListener('input', function() {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => validateA1Certificate(), 500);
                });
            }
        });
        
        async function validateA1Certificate() {
            if (!a1CertFile) return;
            
            const password = document.getElementById('a1-cert-password').value;
            if (!password) {
                document.getElementById('a1-cert-info').style.display = 'none';
                a1CertValid = false;
                updateSignButtonStateModal();
                return;
            }
            
            const formData = new FormData();
            formData.append('certificate', a1CertFile);
            formData.append('password', password);
            
            try {
                const response = await fetch('/api/signer/validate-certificate', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok && result.valid) {
                    a1CertValid = true;
                    const info = result.info;
                    
                    const certInfoDiv = document.getElementById('a1-cert-info');
                    const detailsDiv = document.getElementById('a1-cert-details');
                    
                    certInfoDiv.style.display = 'block';
                    
                    // Verificar validade
                    const validity = info.is_valid;
                    if (!validity.is_valid) {
                        certInfoDiv.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%)';
                        certInfoDiv.style.borderColor = 'rgba(239, 68, 68, 0.3)';
                        certInfoDiv.querySelector('span').textContent = validity.expired ? 'Certificado Expirado' : 'Certificado Inválido';
                        certInfoDiv.querySelector('span').style.color = '#ef4444';
                        certInfoDiv.querySelector('svg').style.stroke = '#ef4444';
                        a1CertValid = false;
                    } else {
                        certInfoDiv.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%)';
                        certInfoDiv.style.borderColor = 'rgba(16, 185, 129, 0.3)';
                    }
                    
                    detailsDiv.innerHTML = `
                        <div><strong>Titular:</strong> ${info.comum_name || 'N/A'}</div>
                        <div><strong>Organização:</strong> ${info.organization || 'N/A'}</div>
                        <div><strong>Emissor:</strong> ${info.issuer_org || info.issuer_cn || 'N/A'}</div>
                        <div><strong>Validade:</strong> ${validity.days_remaining > 0 ? validity.days_remaining + ' dias restantes' : 'Expirado'}</div>
                        ${info.cpf_cnpj ? `<div><strong>CPF/CNPJ:</strong> ${info.cpf_cnpj}</div>` : ''}
                    `;
                } else {
                    a1CertValid = false;
                    document.getElementById('a1-cert-info').style.display = 'none';
                    
                    if (result.error) {
                        showNotification('⚠️ ' + result.error, 'warning');
                    }
                }
            } catch (error) {
                console.error('Erro ao validar certificado:', error);
                a1CertValid = false;
            }
            
            updateSignButtonStateModal();
        }
        
        // CSS para animação de spin
        const styleSheet = document.createElement('style');
        styleSheet.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(styleSheet);

        // Carregar ao iniciar
        loadProcesses();
    </script>

    <!-- Modal de Perfil do Usuário -->
    <div id="profileModal" class="profile-modal-overlay">
        <div class="profile-modal">
            <div id="profileLoading" class="profile-loading" style="display: none;">
                <div class="profile-spinner"></div>
            </div>
            <div class="profile-modal-header">
                <h2 class="profile-modal-title">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Meu Perfil
                </h2>
                <button class="profile-modal-close" onclick="closeProfileModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="profile-modal-body">
                <div class="profile-photo-section">
                    <div class="profile-photo-wrapper">
                        <div class="profile-photo" id="profilePhotoDisplay">
                            {{ session.user_name[0].upper() }}
                        </div>
                        <label class="profile-photo-edit">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                <circle cx="12" cy="13" r="4"/>
                            </svg>
                            <input type="file" id="profilePhotoInput" accept="image/*" onchange="uploadProfilePhoto(this)">
                        </label>
                    </div>
                    <p style="color: #64748b; font-size: 0.85rem;">Clique no ícone de câmera para alterar sua foto</p>
                </div>
                <form id="profileForm" class="profile-form-grid">
                    <div class="profile-form-group full-width">
                        <label class="profile-form-label">Nome / Razão Social</label>
                        <input type="text" class="profile-form-input" id="profileName" placeholder="Seu nome completo">
                    </div>
                    <div class="profile-form-group full-width">
                        <label class="profile-form-label">Razão Social (se aplicável)</label>
                        <input type="text" class="profile-form-input" id="profileRazaoSocial" placeholder="Razão social da empresa">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label">CPF/CNPJ</label>
                        <input type="text" class="profile-form-input" id="profileCpfCnpj" disabled placeholder="Não editável">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label">Email de Acesso</label>
                        <input type="email" class="profile-form-input" id="profileEmail" disabled placeholder="Não editável">
                    </div>
                    <div class="profile-form-group full-width">
                        <label class="profile-form-label">Email Institucional</label>
                        <input type="email" class="profile-form-input" id="profileEmailInstitucional" placeholder="email@instituicao.gov.br">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label">Telefone</label>
                        <input type="tel" class="profile-form-input" id="profileTelefone" placeholder="(00) 00000-0000">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label">CEP</label>
                        <input type="text" class="profile-form-input" id="profileCep" placeholder="00000-000" maxlength="9" onkeyup="buscarCep(this.value)">
                    </div>
                    <div class="profile-form-group full-width">
                        <label class="profile-form-label">Endereço</label>
                        <input type="text" class="profile-form-input" id="profileEndereco" placeholder="Rua, número, complemento">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label">Cidade</label>
                        <input type="text" class="profile-form-input" id="profileCidade" placeholder="Cidade">
                    </div>
                    <div class="profile-form-group">
                        <label class="profile-form-label">Estado</label>
                        <select class="profile-form-input" id="profileEstado">
                            <option value="">Selecione</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amapá</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Ceará</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Espírito Santo</option>
                            <option value="GO">Goiás</option>
                            <option value="MA">Maranhão</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Pará</option>
                            <option value="PB">Paraíba</option>
                            <option value="PR">Paraná</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piauí</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rondônia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">São Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="profile-modal-footer">
                <button class="btn-profile-cancel" onclick="closeProfileModal()">Cancelar</button>
                <button class="btn-profile-save" onclick="saveProfile()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17,21 17,13 7,13 7,21"/>
                        <polyline points="7,3 7,8 15,8"/>
                    </svg>
                    Salvar Alterações
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== FUNÇÃO DE NOTIFICAÇÃO ==========
        function showNotification(message, type = 'info') {
            // Remover notificação anterior se existir
            const existingNotif = document.querySelector('.profile-notification');
            if (existingNotif) existingNotif.remove();
            
            const colors = {
                success: { bg: 'rgba(16, 185, 129, 0.9)', border: 'rgba(16, 185, 129, 0.5)', icon: '✓' },
                error: { bg: 'rgba(239, 68, 68, 0.9)', border: 'rgba(239, 68, 68, 0.5)', icon: '✗' },
                info: { bg: 'rgba(59, 130, 246, 0.9)', border: 'rgba(59, 130, 246, 0.5)', icon: 'i' }
            };
            const style = colors[type] || colors.info;
            
            const notif = document.createElement('div');
            notif.className = 'profile-notification';
            notif.innerHTML = `<span style="font-weight: bold; margin-right: 8px;">${style.icon}</span> ${message}`;
            notif.style.cssText = `
                position: fixed;
                top: 24px;
                right: 24px;
                padding: 16px 24px;
                background: ${style.bg};
                border: 1px solid ${style.border};
                border-radius: 12px;
                color: white;
                font-weight: 500;
                z-index: 100000;
                animation: slideIn 0.3s ease;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                backdrop-filter: blur(10px);
            `;
            document.body.appendChild(notif);
            
            // Adicionar animação CSS se não existir
            if (!document.querySelector('#notifStyle')) {
                const styleEl = document.createElement('style');
                styleEl.id = 'notifStyle';
                styleEl.textContent = '@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }';
                document.head.appendChild(styleEl);
            }
            
            setTimeout(() => {
                notif.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        // ========== FUNÇÕES DO MODAL DE PERFIL ==========
        function openProfileModal() {
            document.getElementById('profileModal').classList.add('active');
            loadProfileData();
        }
        
        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }
        
        async function loadProfileData() {
            document.getElementById('profileLoading').style.display = 'flex';
            try {
                const response = await fetch('/api/profile');
                const data = await response.json();
                
                if (data.success) {
                    const profile = data.profile;
                    document.getElementById('profileName').value = profile.name || '';
                    document.getElementById('profileRazaoSocial').value = profile.razao_social || '';
                    document.getElementById('profileCpfCnpj').value = profile.cpf_cnpj || '';
                    document.getElementById('profileEmail').value = profile.email || '';
                    document.getElementById('profileEmailInstitucional').value = profile.email_institucional || '';
                    document.getElementById('profileTelefone').value = profile.telefone || '';
                    document.getElementById('profileEndereco').value = profile.endereco || '';
                    document.getElementById('profileCidade').value = profile.cidade || '';
                    document.getElementById('profileEstado').value = profile.estado || '';
                    document.getElementById('profileCep').value = profile.cep || '';
                    
                    // Atualizar foto
                    if (profile.foto_perfil) {
                        document.getElementById('profilePhotoDisplay').innerHTML = 
                            `<img src="/${profile.foto_perfil}" alt="Foto de perfil">`;
                        // Atualizar também na navbar
                        const navAvatar = document.getElementById('navUserAvatar');
                        if (navAvatar) {
                            navAvatar.innerHTML = `<img src="/${profile.foto_perfil}" alt="Foto" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                        }
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar perfil:', error);
                showNotification('Erro ao carregar dados do perfil', 'error');
            }
            document.getElementById('profileLoading').style.display = 'none';
        }
        
        async function saveProfile() {
            document.getElementById('profileLoading').style.display = 'flex';
            
            const profileData = {
                name: document.getElementById('profileName').value,
                razao_social: document.getElementById('profileRazaoSocial').value,
                email_institucional: document.getElementById('profileEmailInstitucional').value,
                telefone: document.getElementById('profileTelefone').value,
                endereco: document.getElementById('profileEndereco').value,
                cidade: document.getElementById('profileCidade').value,
                estado: document.getElementById('profileEstado').value,
                cep: document.getElementById('profileCep').value
            };
            
            try {
                const response = await fetch('/api/profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Perfil atualizado com sucesso!', 'success');
                    // Atualizar nome na navbar se mudou
                    if (profileData.name) {
                        document.querySelector('.user-name').textContent = profileData.name;
                    }
                    closeProfileModal();
                } else {
                    showNotification(data.error || 'Erro ao salvar perfil', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar perfil:', error);
                showNotification('Erro ao salvar perfil', 'error');
            }
            document.getElementById('profileLoading').style.display = 'none';
        }
        
        async function uploadProfilePhoto(input) {
            if (!input.files || !input.files[0]) return;
            
            document.getElementById('profileLoading').style.display = 'flex';
            
            const formData = new FormData();
            formData.append('photo', input.files[0]);
            
            try {
                const response = await fetch('/api/profile/photo', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Atualizar foto no modal
                    document.getElementById('profilePhotoDisplay').innerHTML = 
                        `<img src="${data.photo_url}" alt="Foto de perfil">`;
                    // Atualizar na navbar
                    const navAvatar = document.getElementById('navUserAvatar');
                    if (navAvatar) {
                        navAvatar.innerHTML = `<img src="${data.photo_url}" alt="Foto" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                    }
                    showNotification('Foto atualizada com sucesso!', 'success');
                } else {
                    showNotification(data.error || 'Erro ao enviar foto', 'error');
                }
            } catch (error) {
                console.error('Erro ao enviar foto:', error);
                showNotification('Erro ao enviar foto', 'error');
            }
            document.getElementById('profileLoading').style.display = 'none';
        }
        
        // Buscar CEP automaticamente
        async function buscarCep(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length === 8) {
                try {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                    const data = await response.json();
                    if (!data.erro) {
                        document.getElementById('profileEndereco').value = data.logradouro || '';
                        document.getElementById('profileCidade').value = data.localidade || '';
                        document.getElementById('profileEstado').value = data.uf || '';
                    }
                } catch (error) {
                    console.log('Erro ao buscar CEP');
                }
            }
        }
        
        // Máscara de telefone
        document.getElementById('profileTelefone')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            if (value.length > 6) {
                value = `(${value.slice(0, 2)}) ${value.slice(2, 7)}-${value.slice(7)}`;
            } else if (value.length > 2) {
                value = `(${value.slice(0, 2)}) ${value.slice(2)}`;
            } else if (value.length > 0) {
                value = `(${value}`;
            }
            e.target.value = value;
        });
        
        // Máscara de CEP
        document.getElementById('profileCep')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 8) value = value.slice(0, 8);
            if (value.length > 5) {
                value = `${value.slice(0, 5)}-${value.slice(5)}`;
            }
            e.target.value = value;
        });
        
        // Fechar modal ao clicar fora
        document.getElementById('profileModal')?.addEventListener('click', function(e) {
            if (e.target === this) closeProfileModal();
        });
        
        // Fechar modal com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('profileModal').classList.contains('active')) {
                closeProfileModal();
            }
        });
    </script>

    <!-- Modal Validador de Assinatura -->
    <div id="validadorModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <img src="{{ url_for('static', filename='images/só o simbolo.png') }}?v=10" alt="Logo" style="height: 70px; width: auto;">
                    <div>
                        <h2 class="modal-title" style="margin: 0;">Validador de Assinatura Digital</h2>
                        <p style="color: rgba(255,255,255,0.7); margin: 4px 0 0 0; font-size: 0.875rem;">Verifique a conformidade dos seus documentos PDF</p>
                    </div>
                </div>
                <button class="btn btn-icon" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="closeValidadorModal()">
                    <svg style="width: 20px; height: 20px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Upload de Arquivo -->
                <div id="validador-upload" style="text-align: center;">
                    <div style="background: rgba(15, 23, 42, 0.5); border: 2px dashed rgba(59, 130, 246, 0.5); border-radius: 16px; padding: 48px; margin-bottom: 24px;">
                        <svg style="width: 64px; height: 64px; stroke: #60a5fa; fill: none; margin: 0 auto 16px; display: block;" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        <h3 style="font-size: 1.25rem; font-weight: 700; color: #ffffff; margin-bottom: 8px;">Selecione até 3 PDFs para Validar</h3>
                        <p style="color: rgba(255, 255, 255, 0.6); margin-bottom: 24px;">Arraste e solte ou clique para escolher</p>
                        <input type="file" id="validador-file-input" accept=".pdf" multiple style="display: none;" onchange="handleValidadorFiles(this)">
                        <button class="btn btn-primary" onclick="document.getElementById('validador-file-input').click()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none; padding: 14px 28px; font-size: 1rem; display: inline-flex; align-items: center; gap: 8px;">
                            <svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/></svg>
                            Escolher Arquivos PDF
                        </button>
                    </div>
                    
                    <!-- Lista de arquivos selecionados -->
                    <div id="validador-files-list" style="display: none; margin-bottom: 24px;">
                        <h4 style="margin-bottom: 12px; color: #ffffff; display: flex; align-items: center; gap: 8px; justify-content: center;">
                            <svg style="width: 18px; height: 18px; stroke: #60a5fa; fill: none;" viewBox="0 0 24 24"><path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/></svg>
                            Arquivos selecionados:
                        </h4>
                        <div id="validador-files-container" style="display: flex; flex-direction: column; gap: 8px;"></div>
                        <button class="btn btn-primary" id="btnIniciarValidacao" onclick="iniciarValidacao()" style="margin-top: 16px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none; padding: 14px 28px; display: inline-flex; align-items: center; gap: 8px;">
                            <svg style="width: 18px; height: 18px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                            Iniciar Validação
                        </button>
                    </div>
                    
                    <!-- Como funciona -->
                    <div style="margin-top: 24px; text-align: left; background: rgba(59, 130, 246, 0.1); padding: 16px 20px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <h4 style="color: #ffffff; margin: 0 0 8px 0; font-size: 14px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                            <svg style="width: 16px; height: 16px; stroke: #60a5fa; fill: none;" viewBox="0 0 24 24"><path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            Como funciona?
                        </h4>
                        <ul style="color: rgba(255, 255, 255, 0.7); margin: 0; padding-left: 18px; font-size: 13px; line-height: 1.7;">
                            <li>Selecione até 3 arquivos PDF para validar simultaneamente</li>
                            <li>O sistema verificará automaticamente as assinaturas digitais</li>
                            <li>Você receberá um relatório completo sobre cada documento</li>
                            <li>A validação é feita por meio de um validador oficial de assinaturas</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Loading -->
                <div id="validador-loading" style="display: none; text-align: center; padding: 48px;">
                    <div class="loading-spinner" style="width: 48px; height: 48px; border: 3px solid rgba(59, 130, 246, 0.3); border-top-color: #3b82f6; border-radius: 50%; margin: 0 auto 16px; animation: spin 1s linear infinite;"></div>
                    <h3 style="font-size: 1.25rem; font-weight: 700; color: #ffffff; margin-bottom: 8px;">Validando Assinaturas...</h3>
                    <p id="validador-loading-text" style="color: rgba(255, 255, 255, 0.6);">Processando documentos em paralelo...</p>
                    <div style="width: 100%; height: 4px; background: rgba(59, 130, 246, 0.2); border-radius: 2px; margin-top: 24px; overflow: hidden;">
                        <div style="width: 50%; height: 100%; background: linear-gradient(90deg, #3b82f6, #60a5fa); animation: loading 1.5s infinite;"></div>
                    </div>
                    <p style="color: rgba(255, 255, 255, 0.5); font-size: 0.8rem; margin-top: 16px; display: flex; align-items: center; gap: 6px; justify-content: center;">
                        <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        Tempo estimado: 15-20 segundos
                    </p>
                </div>
                
                <!-- Resultado -->
                <div id="validador-resultado" style="display: none;"></div>
            </div>
        </div>
    </div>

    <style>
        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>

    <script>
        let arquivosSelecionados = [];
        
        function openValidadorModal() {
            document.getElementById('validadorModal').style.display = 'flex';
            resetValidador();
        }
        
        function closeValidadorModal() {
            document.getElementById('validadorModal').style.display = 'none';
        }
        
        function resetValidador() {
            arquivosSelecionados = [];
            document.getElementById('validador-upload').style.display = 'block';
            document.getElementById('validador-loading').style.display = 'none';
            document.getElementById('validador-resultado').style.display = 'none';
            document.getElementById('validador-files-list').style.display = 'none';
            document.getElementById('validador-files-container').innerHTML = '';
            document.getElementById('validador-file-input').value = '';
        }
        
        function handleValidadorFiles(input) {
            if (!input.files || input.files.length === 0) return;
            
            // Limitar a 3 arquivos
            const files = Array.from(input.files).slice(0, 3);
            arquivosSelecionados = files;
            
            // Validar tipos
            for (const file of files) {
                if (!file.name.toLowerCase().endsWith('.pdf')) {
                    alert(`O arquivo "${file.name}" não é um PDF.`);
                    arquivosSelecionados = [];
                    return;
                }
            }
            
            // Mostrar lista de arquivos
            const container = document.getElementById('validador-files-container');
            container.innerHTML = '';
            
            files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.style.cssText = 'background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 12px; display: flex; align-items: center; justify-content: space-between;';
                fileItem.innerHTML = `
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <svg style="width: 20px; height: 20px; stroke: #60a5fa; fill: none;" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        <span style="font-weight: 500; color: #ffffff;">${file.name}</span>
                        <span style="color: rgba(255, 255, 255, 0.5); font-size: 0.8rem;">(${(file.size / 1024).toFixed(1)} KB)</span>
                    </span>
                    <button onclick="removerArquivo(${index})" style="background: rgba(220, 38, 38, 0.2); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: 6px; padding: 6px 10px; cursor: pointer; color: #f87171; display: flex; align-items: center; justify-content: center;">
                        <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                `;
                container.appendChild(fileItem);
            });
            
            document.getElementById('validador-files-list').style.display = 'block';
            
            if (files.length >= 3) {
                alert('Máximo de 3 arquivos permitidos.');
            }
        }
        
        function removerArquivo(index) {
            arquivosSelecionados.splice(index, 1);
            if (arquivosSelecionados.length === 0) {
                document.getElementById('validador-files-list').style.display = 'none';
            } else {
                // Recriar lista
                const container = document.getElementById('validador-files-container');
                container.innerHTML = '';
                arquivosSelecionados.forEach((file, idx) => {
                    const fileItem = document.createElement('div');
                    fileItem.style.cssText = 'background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 12px; display: flex; align-items: center; justify-content: space-between;';
                    fileItem.innerHTML = `
                        <span style="display: flex; align-items: center; gap: 8px;">
                            <svg style="width: 20px; height: 20px; stroke: #4ade80; fill: none;" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                            <span style="font-weight: 500; color: #4ade80;">${file.name}</span>
                            <span style="color: rgba(255, 255, 255, 0.5); font-size: 0.8rem;">(${(file.size / 1024).toFixed(1)} KB)</span>
                        </span>
                        <button onclick="removerArquivo(${idx})" style="background: rgba(220, 38, 38, 0.2); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: 6px; padding: 6px 10px; cursor: pointer; color: #f87171; display: flex; align-items: center; justify-content: center;">
                            <svg style="width: 14px; height: 14px; stroke: currentColor; fill: none;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    `;
                    container.appendChild(fileItem);
                });
            }
        }
        
        async function iniciarValidacao() {
            if (arquivosSelecionados.length === 0) {
                alert('Selecione pelo menos um arquivo.');
                return;
            }
            
            // Mostrar loading
            document.getElementById('validador-upload').style.display = 'none';
            document.getElementById('validador-files-list').style.display = 'none';
            document.getElementById('validador-loading').style.display = 'block';
            document.getElementById('validador-loading-text').textContent = 
                `Processando ${arquivosSelecionados.length} documento(s) em paralelo...`;
            
            const formData = new FormData();
            
            if (arquivosSelecionados.length === 1) {
                // Usar endpoint single
                formData.append('file', arquivosSelecionados[0]);
                console.log('[RPPS DEBUG] Enviando arquivo:', arquivosSelecionados[0].name);
                
                try {
                    const response = await fetch('/api/validar-assinatura', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    console.log('[RPPS DEBUG] Resposta da API:', JSON.stringify(data, null, 2));
                    document.getElementById('validador-loading').style.display = 'none';
                    
                    if (data.success) {
                        const resultadoFormatado = [{
                            nome_arquivo: arquivosSelecionados[0].name,
                            ...data.resultado
                        }];
                        console.log('[RPPS DEBUG] Resultado formatado:', JSON.stringify(resultadoFormatado, null, 2));
                        mostrarResultadoValidacao(resultadoFormatado);
                    } else {
                        alert('Erro: ' + (data.error || 'Falha na validação'));
                        resetValidador();
                    }
                } catch (error) {
                    console.error('[RPPS DEBUG] Erro:', error);
                    document.getElementById('validador-loading').style.display = 'none';
                    alert('Erro ao conectar com o servidor');
                    resetValidador();
                }
            } else {
                // Usar endpoint múltiplo
                arquivosSelecionados.forEach(file => {
                    formData.append('files[]', file);
                });
                console.log('[RPPS DEBUG] Enviando arquivos:', arquivosSelecionados.map(f => f.name));
                
                try {
                    const response = await fetch('/api/validar-assinaturas-multiplas', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    console.log('[RPPS DEBUG] Resposta da API múltipla:', JSON.stringify(data, null, 2));
                    document.getElementById('validador-loading').style.display = 'none';
                    
                    if (data.success) {
                        console.log('[RPPS DEBUG] Resultados múltiplos:', JSON.stringify(data.resultados, null, 2));
                        mostrarResultadoValidacao(data.resultados);
                    } else {
                        alert('Erro: ' + (data.error || 'Falha na validação'));
                        resetValidador();
                    }
                } catch (error) {
                    console.error('[RPPS DEBUG] Erro:', error);
                    document.getElementById('validador-loading').style.display = 'none';
                    alert('Erro ao conectar com o servidor');
                    resetValidador();
                }
            }
        }
        
        function mostrarResultadoValidacao(resultados) {
            // Suporta array de resultados (múltiplos arquivos) ou objeto único
            if (!Array.isArray(resultados)) {
                resultados = [resultados];
            }
            
            document.getElementById('validador-loading').style.display = 'none';
            document.getElementById('validador-resultado').style.display = 'block';
            
            let html = '';
            
            // Cabeçalho com resumo geral
            const todosValidos = resultados.every(r => r.detalhes_tcees?.resultado_final === 'VALIDADO');
            const algumInvalido = resultados.some(r => r.detalhes_tcees?.resultado_final !== 'VALIDADO');
            
            const successSvg = '<svg style="width: 64px; height: 64px; stroke: #4ade80; fill: none; margin: 0 auto 12px; display: block;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            const warningSvg = '<svg style="width: 64px; height: 64px; stroke: #fbbf24; fill: none; margin: 0 auto 12px; display: block;" viewBox="0 0 24 24"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>';
            const errorSvg = '<svg style="width: 64px; height: 64px; stroke: #f87171; fill: none; margin: 0 auto 12px; display: block;" viewBox="0 0 24 24"><path d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            
            html += `
                <div style="text-align: center; padding: 24px; margin-bottom: 24px; background: ${todosValidos ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; border-radius: 16px; border: 2px solid ${todosValidos ? 'rgba(34, 197, 94, 0.5)' : 'rgba(239, 68, 68, 0.5)'};">
                    ${todosValidos ? successSvg : (algumInvalido ? warningSvg : errorSvg)}
                    <h3 style="font-size: 1.5rem; font-weight: 700; color: ${todosValidos ? '#4ade80' : '#f87171'}; margin-bottom: 8px;">
                        ${todosValidos ? 'Todos os Documentos Válidos!' : 'Atenção: Verificar Resultados'}
                    </h3>
                    <p style="color: rgba(255, 255, 255, 0.6);">${resultados.length} documento(s) analisado(s)</p>
                </div>
            `;
            
            const itemSuccessSvg = '<svg style="width: 28px; height: 28px; stroke: #4ade80; fill: none;" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            const itemErrorSvg = '<svg style="width: 28px; height: 28px; stroke: #f87171; fill: none;" viewBox="0 0 24 24"><path d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
            
            // Resultados individuais
            resultados.forEach((resultado, index) => {
                const tcees = resultado.detalhes_tcees || {};
                const isValid = tcees.resultado_final === 'VALIDADO';
                const nomeArquivo = resultado.nome_arquivo || `Documento ${index + 1}`;
                
                html += `
                    <div style="background: rgba(30, 41, 59, 0.6); border: 2px solid ${isValid ? 'rgba(34, 197, 94, 0.5)' : 'rgba(239, 68, 68, 0.5)'}; border-radius: 12px; margin-bottom: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);">
                        <!-- Cabeçalho do documento -->
                        <div style="background: ${isValid ? 'rgba(34, 197, 94, 0.15)' : 'rgba(239, 68, 68, 0.15)'}; padding: 16px; display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                ${isValid ? itemSuccessSvg : itemErrorSvg}
                                <div>
                                    <div style="font-weight: 700; color: #ffffff; font-size: 1rem;">${nomeArquivo}</div>
                                    <div style="font-size: 0.875rem; color: ${isValid ? '#4ade80' : '#f87171'}; font-weight: 600;">
                                        ${isValid ? 'Documento Válido' : 'Documento Inválido'}
                                    </div>
                                </div>
                            </div>
                            <div style="background: ${isValid ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)'}; color: white; padding: 8px 20px; border-radius: 20px; font-weight: 700; font-size: 1rem;">
                                ${tcees.pontuacao || 0}%
                            </div>
                        </div>
                        
                        <!-- Tabela de Conformidade -->
                        <div style="padding: 16px; overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; text-align: center; font-size: 0.8rem;">
                                <thead>
                                    <tr style="background: rgba(30, 41, 59, 0.8);">
                                        <th style="padding: 10px 6px; border-bottom: 2px solid rgba(59, 130, 246, 0.3); color: #ffffff;">Extensão</th>
                                        <th style="padding: 10px 6px; border-bottom: 2px solid rgba(59, 130, 246, 0.3); color: #ffffff;">Sem senha</th>
                                        <th style="padding: 10px 6px; border-bottom: 2px solid rgba(59, 130, 246, 0.3); color: #ffffff;">Tam. arquivo</th>
                                        <th style="padding: 10px 6px; border-bottom: 2px solid rgba(59, 130, 246, 0.3); color: #ffffff;">Tam. página</th>
                                        <th style="padding: 10px 6px; border-bottom: 2px solid rgba(59, 130, 246, 0.3); color: #ffffff;">Assinado</th>
                                        <th style="padding: 10px 6px; border-bottom: 2px solid rgba(59, 130, 246, 0.3); color: #ffffff;">Autent./Integ.</th>
                                        <th style="padding: 10px 6px; border-bottom: 2px solid rgba(59, 130, 246, 0.3); color: #ffffff;">Pesquisável</th>
                                        <th style="padding: 10px 6px; border-bottom: 2px solid rgba(59, 130, 246, 0.3); color: #ffffff; font-weight: 700;">Resultado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="background: rgba(30, 41, 59, 0.4);">
                                        <td style="padding: 12px 6px; text-align: center;">${tcees.extensao_valida ? '<svg style="width: 22px; height: 22px; stroke: #4ade80; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>' : '<svg style="width: 22px; height: 22px; stroke: #f87171; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>'}</td>
                                        <td style="padding: 12px 6px; text-align: center;">${tcees.sem_senha ? '<svg style="width: 22px; height: 22px; stroke: #4ade80; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>' : '<svg style="width: 22px; height: 22px; stroke: #f87171; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>'}</td>
                                        <td style="padding: 12px 6px; text-align: center;">${tcees.tamanho_arquivo_ok ? '<svg style="width: 22px; height: 22px; stroke: #4ade80; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>' : '<svg style="width: 22px; height: 22px; stroke: #f87171; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>'}</td>
                                        <td style="padding: 12px 6px; text-align: center;">${tcees.tamanho_pagina_ok ? '<svg style="width: 22px; height: 22px; stroke: #4ade80; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>' : '<svg style="width: 22px; height: 22px; stroke: #f87171; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>'}</td>
                                        <td style="padding: 12px 6px; text-align: center;">${tcees.assinado ? '<svg style="width: 22px; height: 22px; stroke: #4ade80; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>' : '<svg style="width: 22px; height: 22px; stroke: #f87171; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>'}</td>
                                        <td style="padding: 12px 6px; text-align: center;">${tcees.autenticidade_ok ? '<svg style="width: 22px; height: 22px; stroke: #4ade80; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>' : '<svg style="width: 22px; height: 22px; stroke: #f87171; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>'}</td>
                                        <td style="padding: 12px 6px; text-align: center;">${tcees.pesquisavel ? '<svg style="width: 22px; height: 22px; stroke: #4ade80; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>' : '<svg style="width: 22px; height: 22px; stroke: #f87171; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>'}</td>
                                        <td style="padding: 12px 6px; text-align: center;">${isValid ? '<svg style="width: 26px; height: 26px; stroke: #4ade80; fill: none; stroke-width: 3;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>' : '<svg style="width: 26px; height: 26px; stroke: #f87171; fill: none; stroke-width: 3;" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"/></svg>'}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            // Botões com cores do sistema - Dark Theme
            html += `
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button class="btn btn-secondary" onclick="resetValidador()" style="flex: 1; padding: 14px; font-weight: 600; background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255, 255, 255, 0.15); color: #ffffff; border-radius: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s ease;">
                        <svg style="width: 18px; height: 18px; stroke: #60a5fa; fill: none; stroke-width: 2;" viewBox="0 0 24 24"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                        Validar Outros Documentos
                    </button>
                    <button class="btn btn-primary" onclick="closeValidadorModal()" style="flex: 1; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); border: none; padding: 14px; font-weight: 600; border-radius: 12px; color: #ffffff; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); transition: all 0.3s ease;">
                        <svg style="width: 18px; height: 18px; stroke: #ffffff; fill: none; stroke-width: 2.5;" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
                        Fechar
                    </button>
                </div>
            `;
            
            document.getElementById('validador-resultado').innerHTML = html;
        }
    </script>

    <!-- Script da Animação Tech de Partículas - Versão Equilibrada -->
    <script>
        (function() {
            const canvas = document.getElementById('particles-canvas');
            const ctx = canvas.getContext('2d');
            
            let particles = [];
            const particleCount = 60;
            const connectionDistance = 150;
            const mouseRadius = 150;
            
            let mouse = { x: null, y: null };
            let time = 0;
            
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = Math.max(document.documentElement.scrollHeight, window.innerHeight);
            }
            
            class Particle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.baseSize = Math.random() * 1.5 + 1;
                    this.size = this.baseSize;
                    this.speedX = (Math.random() - 0.5) * 0.4;
                    this.speedY = (Math.random() - 0.5) * 0.4;
                    this.pulseOffset = Math.random() * Math.PI * 2;
                }
                
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    this.size = this.baseSize + Math.sin(time * 0.015 + this.pulseOffset) * 0.3;
                    if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
                    if (mouse.x !== null) {
                        const dx = mouse.x - this.x;
                        const dy = (mouse.y + window.scrollY) - this.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist < mouseRadius && dist > 30) {
                            this.x += dx * ((mouseRadius - dist) / mouseRadius * 0.015);
                            this.y += dy * ((mouseRadius - dist) / mouseRadius * 0.015);
                        }
                    }
                }
                
                draw() {
                    // Glow suave
                    const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 2.5);
                    gradient.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
                    gradient.addColorStop(0.5, 'rgba(59, 130, 246, 0.15)');
                    gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * 2.5, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // Core
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(59, 130, 246, 0.6)';
                    ctx.fill();
                }
            }
            
            function initParticles() {
                particles = [];
                for (let i = 0; i < particleCount; i++) particles.push(new Particle());
            }
            
            function connectParticles() {
                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < connectionDistance) {
                            const opacity = (1 - distance / connectionDistance) * 0.25;
                            ctx.beginPath();
                            ctx.strokeStyle = `rgba(59, 130, 246, ${opacity})`;
                            ctx.lineWidth = 1;
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.stroke();
                        }
                    }
                }
                // Conexão com mouse
                if (mouse.x !== null) {
                    const mouseY = mouse.y + window.scrollY;
                    particles.forEach(p => {
                        const dx = p.x - mouse.x, dy = p.y - mouseY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < mouseRadius) {
                            const opacity = (1 - distance / mouseRadius) * 0.3;
                            ctx.beginPath();
                            ctx.strokeStyle = `rgba(96, 165, 250, ${opacity})`;
                            ctx.lineWidth = 1;
                            ctx.moveTo(p.x, p.y);
                            ctx.lineTo(mouse.x, mouseY);
                            ctx.stroke();
                        }
                    });
                }
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                time++;
                particles.forEach(p => { p.update(); p.draw(); });
                connectParticles();
                requestAnimationFrame(animate);
            }
            
            window.addEventListener('resize', () => { resizeCanvas(); initParticles(); });
            window.addEventListener('scroll', () => { resizeCanvas(); });
            document.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; });
            document.addEventListener('mouseleave', () => { mouse.x = null; mouse.y = null; });
            
            resizeCanvas();
            initParticles();
            animate();
        })();
    </script>

    <!-- Controle de Zoom -->
    <div class="zoom-control">
        <div class="zoom-container">
            <button class="zoom-btn" id="zoomIn" title="Aumentar Zoom">+</button>
            <span class="zoom-value" id="zoomValue">100%</span>
            <button class="zoom-btn" id="zoomOut" title="Diminuir Zoom">−</button>
            <button class="zoom-reset" id="zoomReset" title="Resetar Zoom">100</button>
        </div>
    </div>

    <script>
        // Controle de Zoom
        const zoomIn = document.getElementById('zoomIn');
        const zoomOut = document.getElementById('zoomOut');
        const zoomValue = document.getElementById('zoomValue');
        const zoomReset = document.getElementById('zoomReset');
        let currentZoom = parseInt(localStorage.getItem('pageZoom')) || 100;

        function updateZoom(zoom) {
            zoom = Math.max(50, Math.min(150, zoom));
            currentZoom = zoom;
            zoomValue.textContent = zoom + '%';
            document.body.style.zoom = zoom / 100;
            localStorage.setItem('pageZoom', zoom);
        }

        // Aplicar zoom salvo
        updateZoom(currentZoom);

        zoomIn.addEventListener('click', () => updateZoom(currentZoom + 10));
        zoomOut.addEventListener('click', () => updateZoom(currentZoom - 10));
        zoomReset.addEventListener('click', () => updateZoom(100));
    </script>

    <!-- Carregar foto do perfil ao iniciar a página -->
    <script>
        (async function loadUserProfilePhoto() {
            try {
                const response = await fetch('/api/profile');
                const data = await response.json();
                
                if (data.success && data.profile.foto_perfil) {
                    const navAvatar = document.getElementById('navUserAvatar');
                    if (navAvatar) {
                        navAvatar.innerHTML = `<img src="/${data.profile.foto_perfil}" alt="Foto" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                    }
                }
            } catch (error) {
                console.log('Foto de perfil não carregada');
            }
        })();
    </script>

    <!-- Botão Fullscreen Premium -->
    <button class="fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()" title="Tela Cheia">
        <span class="fullscreen-btn-tooltip" id="fullscreenTooltip">Tela Cheia</span>
        <svg class="icon-expand" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 3H5a2 2 0 0 0-2 2v3"/>
            <path d="M21 8V5a2 2 0 0 0-2-2h-3"/>
            <path d="M3 16v3a2 2 0 0 0 2 2h3"/>
            <path d="M16 21h3a2 2 0 0 0 2-2v-3"/>
        </svg>
        <svg class="icon-compress" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 14h6v6"/>
            <path d="M20 10h-6V4"/>
            <path d="M14 10l7-7"/>
            <path d="M3 21l7-7"/>
        </svg>
    </button>

    <script>
        // Fullscreen Toggle Function
        function toggleFullscreen() {
            const btn = document.getElementById('fullscreenBtn');
            const tooltip = document.getElementById('fullscreenTooltip');
            
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
                // Entrar em tela cheia
                const elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
                btn.classList.add('is-fullscreen');
                tooltip.textContent = 'Sair da Tela Cheia';
            } else {
                // Sair da tela cheia
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                btn.classList.remove('is-fullscreen');
                tooltip.textContent = 'Tela Cheia';
            }
        }

        // Listener para mudanças no estado fullscreen
        document.addEventListener('fullscreenchange', updateFullscreenState);
        document.addEventListener('webkitfullscreenchange', updateFullscreenState);
        document.addEventListener('msfullscreenchange', updateFullscreenState);

        function updateFullscreenState() {
            const btn = document.getElementById('fullscreenBtn');
            const tooltip = document.getElementById('fullscreenTooltip');
            if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                btn.classList.add('is-fullscreen');
                tooltip.textContent = 'Sair da Tela Cheia';
            } else {
                btn.classList.remove('is-fullscreen');
                tooltip.textContent = 'Tela Cheia';
            }
        }

        // Atalho de teclado F11
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F11') {
                e.preventDefault();
                toggleFullscreen();
            }
        });
    </script>

</body>
</html>